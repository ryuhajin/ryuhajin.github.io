---
layout: default
title: "4. Rendering Frames"
parent: "HLSL"
nav_order: 5
---

# 4. Rendering Frames
direct3D 초기화 후 실제 렌더링을 시작하기 위해 두가지 사전 작업을 수행해야 한다

1. GPU에게 최종 이미지를 생성할 메모리 위치를 알려주기
    - 대부분의 경우 백 버퍼
2. GPU에게 백 버퍼의 어느 위치에 그리도록 지시하기

위 작업이 완료되면 렌더링을 수행할 수 있다

---

## Setting the Render Target
direct3D에서 렌더링을 하기 위해서는 렌더 타겟을 설정해야 한다

- 렌더 타겟 설정 과정
1. 백 버퍼의 주소 확인하기
2. 백 버퍼 주소를 사용하여 렌더 타겟을 나타내는 COM 객체 생성하기
3. 하당 객체를 활성 렌더 타겟으로 설정하기

```c++
ID3D11RenderTargetView *backbuffer; // COM 객체 전역 선언

 // 이 함수는 Direct3D를 초기화하고 사용할 준비를 합니다 
void InitD3D(HWND hWnd) 
{ 
    // Direct3D 초기화 
    // ... 

	// 렌더 타겟 설정 시작

	// 백 버퍼의 주소 가져오기
	ID3D11Texture2D* pBackBuffer;
	swapchain->GetBuffer(0, __uuidof(ID3D11Texture2D), (LPVOID*)&pBackBuffer);

	// 백 버퍼의 주소 사용하여 렌더 타겟 생성
	dev->CreateRenderTargetView(pBackBuffer, NULL, &backbuffer);
	pBackBuffer->Release();

	// 렌더 타겟을 백 버퍼로 설정
	devcon->OMSetRenderTargets(1, &backbuffer, NULL);
 }
```

- **ID3D11RenderTargetView *backbuffer**
  - 렌더 타겟에 대한 모든 정보를 담고 있는 객체를 가리키는 포인터
  - 백버퍼에 렌더링 할 것이므로 변수 이름을 backbuffer로 지정했다
- **ID3D11Texture2D *pBackBuffer**
  - 평면 이미지를 저장하는 객체
- **swapchain->GetBuffer(0, __uuidof(ID3D11Texture2D), (LPVOID*)&pBackBuffer)**
  - `GetBuffer()` 함수가 하는 일 : 스왑 체인에서 백 버퍼를 찾아 pBackBuffer 텍스처 객체를 생성
  - 첫 번째 매개변수 : 가져올 백 버퍼의 번호 (백 버퍼를 1개만 사용하기 때문에 백 버퍼는 0)
  - 두 번째 매개변수 : ID3D11Texture2D 객체를 식별하는 숫자
    - `__uuidof()`는 COM 객체의 고유한 ID를 얻는 연산자
    - `LPVOID` : 모든 형식에 대한 포인터 (`typedef void *LPVOID;`)
- **dev->CreateRenderTargetView(pBackBuffer, NULL, &backbuffer)**
  - 렌더 타겟 객체 생성
  - 첫 번째 매개변수 : 텍스처 객체에 대한 포인터
  - 두 번째 매개변수 : 렌더 타겟을 설명하는 구조체. 백 버퍼는 이 구조체를 채울 필요가 없다
  - 세 번째 매개변수 : 렌더 타겟 객체 포인터 주소 (`&backbuffer`)
- **pBackBuffer->Release()**
  - 백 버퍼에 접근하는데 사용했던 텍스처 객체의 메모리 해제 후 스레드 닫기
- **devcon->OMSetRenderTargets(1, &backbuffer, NULL)** 
  - 렌더 타겟 설정. 여러 렌더 타겟을 설정할 수 있음
  - 첫 번째 매개변수 : 설정한 렌더 타겟의 개수
  - 두 번째 매개변수 : 렌더 타겟 뷰 객체 목록을 가리키는 포인터
  - 세 번째 매개변수 : 고급 매개변수로 이후 글에서 자세히 다룸

---

## Setting the Viewport

