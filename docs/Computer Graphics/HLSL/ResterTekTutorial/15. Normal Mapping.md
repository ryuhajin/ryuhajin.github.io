---
layout: default
title: "15. Normal Mapping"
parent: "ResterTekTutorial"
nav_order: 15
---

# 15. Normal Mapping
노멀 맵은 본질적으로 표면 노멀을 위한 참조 테이블이다

- 노멀 맵의 각 픽셀은 텍스처 색상 맵의 해당 픽셀에 대한 빛의 방향을 나타낸다

---

## Bump Mapping
메시의 기하학적 형태(정점, 폴리곤 수)는 그대로 유지하면서 노멀 벡터를 픽셀 단위로 조작해 광원 계산 시 표면이 울퉁불퉁해 보이도록 만드는 기법

## Bump Mapping vs Normal Mapping
노멀 매핑이 범프 매핑의 개념을 발전시킨 것

- 범프 매핑: **흑백 텍스처(높이 정보)를 사용**하며, 셰이더에서 실시간으로 높이 변화를 계산하여 법선을 수정
  - 흰색 : 높은 지점
  - 검은색 : 낮은 지점 
- 노멀 매핑: 처음부터 **왜곡된 법선 벡터의 방향(X, Y, Z) 정보를 컬러(R, G, B) 값에 직접 저장**한 '노멀 맵'
  - 노멀 텍스처를 읽어와서 바로 법선으로 사용하므로 연산이 더 빠르고 효율적 

---

## Normal Map
노멀 맵에 저장되는 **방향 정보 좌표계는 탄젠트 공간(Tangent Space) 기준**이다

## Tangent Space
각 **픽셀(텍셀)마다 정의되는 작은 좌표축 집합**. 모델 **표면의 각 정점(Vertex)마다 설정**되는 고유의 로컬 좌표계

- **Tangent** (T): 표면 위에서 U 텍스처 좌표가 증가하는 방향 벡터
- **Bitangent/Binormal** (B): 표면 위에서 V 텍스처 좌표가 증가하는 방향 벡터
- **Normal** (N): 표면에서 수직으로 솟은 벡터

> (T, B, N)이 한 점의 직교 기저(orthonormal basis)를 이룬다

---

## Normal Map Color value
RGB 색상값은 `[0, 255]` 범위이고, 법선 벡터는 보통 `[-1, 1]` 범위를 가짐

- 벡터의 각 성분(X, Y, Z)은 **-1.0에서 +1.0 사이의 범위를 가져야 방향을 제대로 표현** 가능
- 따라서 `× 2.0 - 1.0` 연산을 통해 범위를 확장

```
v_normalized = (color / 255.0) * 2.0 - 1.0

R → X축 성분   X = (R / 255) * 2 - 1
G → Y축 성분   Y = (G / 255) * 2 - 1
B → Z축 성분   Z = (B / 255) * 2 - 1
```

> 여기서 헷갈린 점 : 벡터를 color 값으로 변환할 때 255가 있는 수식이 있고 없는 수식이 있다는 점이다

---

## Texture.Sample(SampleType, input.tex);
### 1. 텍스처 저장 형식
- 이미지 파일에서 픽셀은 0~255 범위의 정수로 저장
- 예: R=128, G=200, B=255

### 2. 샘플러 동작
- GPU에서 sampler2D 같은 텍스처 샘플러를 쓰면, 하드웨어가 0~255 정수 값을 자동으로 0.0~1.0 부동소수점으로 정규화해서 쉐이더에 넘겨줌
- 즉, `Texture.Sample(SampleType, input.tex)` 하면 이미 `vec3(0.0~1.0)` 범위 값이 나옴

### 3. 벡터 변환 수식
따라서

- (R / 255) * 2 - 1 → 텍스쳐 원시 데이터(정수) 기준 수식
- (Color Value * 2) - 1 → 샘플러로 불러온 후 쉐이더에서 쓰는 수식

> 즉, 샘플러가 /255를 이미 해주기 때문에 쉐이더에서는 후자만 쓰면 됨

---

## Color → Vector


---

$$ \text{Vector Component} = (\text{Color Value} × 2.0) − 1.0 $$

---

## Vector → Color

---

$$ \text{Color Value} = (\text{Vector Component} + 1.0) / 2.0 $$

---

## TBN
TBN 내용 추가하기