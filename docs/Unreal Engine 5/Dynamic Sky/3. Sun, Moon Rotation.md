---
layout: default
title: "3. Sun, Moon Rotation"
parent: "Dynamic Sky"
nav_order: 3
---

# 3. Sun, Moon Rotation
시스템에 시간 요소 설정하기

## Basic Rotation
dirtection right는 y축을 기준으로 태양이 돌아감

```
y축 회전 범위 : 0 ~ 180도

0 : 일출
-90 : 정오
-180 : 일몰
```

## Handle SunMoon Ratation 함수
Construction Script를 활용하여 하루의 시간(Time of Day) 변화에 따라 태양(Directional Light)의 위치를 자동으로 회전시키는 기능을 구현


## 변수
1. Time of Day (float)
    - 현재 시간 (0 ~ 24)
2. Dawn Time (float)
    - 해가 뜨는 시간 (예: 06시)
3. Dusk Time (float)
    - 해가 지는 시간 (예: 18시)

> 태양의 높이 (고도) 조절이므로 y축 기준으로 회전

- BP 변수 단축키

```
Ctrl + Drag	변수 가져오기 (Get)
Alt + Drag	변수 설정하기 (Set)
```

---

## MapRangeUnclamped
A라는 범위의 숫자를 비율에 맞춰 B라는 범위의 숫자로 변환(Remapping)

### 매개변수
1. **value**
 - B 범위로 바꿀 입력값
2. **In range A, In range B**
    - 기존의 value가 있던 범위
3. **Out range A, Out range B**
    - 재매핑할 범위

> 출력 : 재매핑된 범위의 값

---

## MapRangeUnclamped vs MapRangeClamped 차이점

<br>

- `Clamped`의 경우 : **Out A ~ Out B를 절대 벗어나지 않도록 강제로 자름**
- `Unclamped` 경우 : 입력값이 범위를 벗어나더라도, **계산된 비율(직선의 기울기)을 그대로 유지하며 값을 계속 확장**

```
예시 
Input Range: 0 ~ 10
Output Range: 0 ~ 100
```

입력값 | MapRange Clamped | MapRange Unclamped | 설명 |
---|---|---|---|
5 | 50 | 50 | 범위 내(중간)이므로 동일 |
10| 100 | 100 | 범위 끝값이므로 동일 |
15 |100 | 150 | Clamped는 100에서 멈춤, Unclamped는 비율대로 더 커짐 |
-5 | 0 | -50 | Clamped는 0에서 멈춤, Unclamped는 음수로 내려감 |

---

# moon rotation

## BP 함수 vs 이벤트 vs 매크로

특성	| 함수 (Function) | 이벤트 (Event) | 매크로 (Macro) |
---|---|---|---|
C++ 비유 |	`void MyFunc() { ... }`	| Delegate / Callback / Interrupt | `#define / inline` 코드 확장
실행 방식 |	Call (스택에 주소 푸시 후 점프)	| Trigger (신호가 오면 실행 시작) |	Expansion (컴파일 시 노드 복사/붙여넣기) |
반환값 (Return)	| 가능 (필수 아님)	| 불가능 (Output 파라미터 없음)	| 가능 (하지만 Output 핀 개념) |
지연 노드 (Delay)	| 불가능 (즉시 리턴되어야 함)	| 가능 (비동기 흐름의 시작점)	| 가능 (단, 이벤트 그래프에 배치될 때만) |
다른 클래스에서 호출 | 가능 (Yes)	| 가능 (Yes) |	불가능 (No) |
RPC (네트워크)	| 불가능 (이벤트로 감싸야 함)	| 가능 (Server, Client, NetMulticast)	| 불가능 |
실행 핀 (Exec)	| 입력 1개 / 출력 1개 | 입력 0개(트리거) / 출력 1개	| 입력 N개 / 출력 N개 (멀티 흐름 가능) |


```
함수와 이벤트 : 컴파일되면 바이너리 상에서 고유한 메모리 주소(Entry Point)를 가짐
    - 해당 포인터를 통해 그 메모리 주소로 점프 가능

매크로 : 컴파일되면 코드가 그대로 복사 붙여넣기 됨
    - 따라서 외부에서 호출할 방법 없음
```

---

## Visibility (가시성) 제어
대기 산란은 성능 비용이 매우 높음

- 따라서 두 개의 directional Light (태양, 달) 중 우선순위가 높은 하나만 골라서 하늘 색 계산
- `SetVisibility` 노드를 통해 시간에 따라 태양 또는 달 가시성 on/off

### IsDayTime 매크로
현재 시간이 낮인지 밤인지 판별하는 매크로

```
DawnTime - 0.3 < TimeOfDay < DuskTime + 0.3
```

- 해당 범위 안에 있으면 낮 반환 (true)
- 해당 범위 밖이면 밤 반환 (false)

### HandleVisibility 함수
Construction Script에서 해당 함수 호출하여 에디터에서 시간 값 반영하여 렌더링

```
만약 IsDaytime 매크로가 True라면?
    - Sun Light : Visible
    - Moon Light : Hidden

만약 IsNighttime이 True라면? (IsDaytime의 False)
    - Sun Light : Hidden
    - Moon Light : Visible
```
