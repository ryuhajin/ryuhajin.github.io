---
layout: default
title: "5. Stars material"
parent: "Dynamic Sky"
nav_order: 5
---

# 5. Stars material
스카이 스피어(Sky Sphere) 메쉬를 도입하고, 그 위에 입힐 재질(Material) 만들기

---

## sky material

### IsSky
머티리얼 디테일 패널의 `Is Sky` 체크하는 의미

1. 깊이 버퍼 최적화
    - **깊이 테스트 무시됨**
    - 해당 버튼이 체크되면 **가장 마지막에 그림**
    - 건물, 캐릭터, 나무 등을 먼저 다 그리고 나서, **아직 아무것도 그려지지 않은 빈 픽셀**에만 하늘 그림
2. 대기 산란 상호작용
    - Sky Atmosphere 시스템과 상호작용
    - 체크해야 대기 산란 효과가 올바르게 적용됨

---

## SkyAtmosphere 관련 노드
`Unlit + IsSky` 체크된 스카이돔 머티리얼, 구름효과 등에 사용됨

```
SkyAtmosphere 관련 머티리얼 노드들은
Sky Atmosphere 컴포넌트가 미리 계산해 둔 LUT(텍스처)에서
“하늘 색, 대기 안개, 태양/달 디스크, 조명 정보”를 꺼내 쓰는 역할
```

### SkyAtmosphereViewLuminance
카메라가 보고 있는 방향의 하늘 색을 그대로 가져오는 노드

- **입력** : 없음 (뷰 방향 기반)
- **출력** : 하늘 픽셀 자체의 HDR 색 (태양/달 디스크 제외한 스카이 컬러)

```
즉 하늘 배경 색 → Emissive에 직결
```

---

### SkyAtmosphereLightDiskLuminance
태양/달 디스크 자체의 밝기 (HDR)를 주는 노드

- **입력** : Directional Light index (태양 = 0, 달 = 1 과 같은 식)
- **출력** : 대기를 통과한 후 태양/달 디스크 HDR 휘도

```
디스크 마스크(원형, 소프트 엣지)  → ViewLuminance 위에 Add
```

---

### SkyAtmosphereAerialPerspective
카메라에서 어떤 월드 위치까지 가는 동안의 대기 안개 색 + 투명도

- 하늘 배경 전체를 그리기 위한 노드가 아니라 **“대기 안개 오버레이”**에 가까움
- **입력** : World Position (보통 Absolute World Position)
- **출력**
  - RGB : 그 지점까지 가는 동안 공기에서 추가된 빛(안개 색)
  - A : 카메라에서 그 지점까지 빛이 얼마나 남는지 (1 = 공기 없음, 0 = 완전 안개)

```
SkyAtmosphereAerialPerspective(WorldPosition) → RGB/A를 색/알파에 섞어서 공기감 추가
```

---

### SkyAtmosphereLightDirection
지정한 Atmospheric Light Index의 방향 벡터

- **입력** : Light Index (태양/달 구분 용)
- **출력** : float3 라이트 방향 (보통 -LightDir이 빛이 오는 방향)

**용도**
1. 머티리얼 내부에서 태양/달 방향으로 라이트 계산할 때
2. 구름 dot(N, L)
3. 림라이트, 스카이돔 상의 highlight, 라이트 마스크 방향 등
4. 태양/달 디스크 위치 계산 (uv 상 위치를 라이트 방향으로 투영)

```
SkyAtmosphereLightDirection(LightIndex) → dot(N, L), rim light, 구름 라이트 등
```

---

## 정리
1. **하늘 배경 색**
    - SkyAtmosphereViewLuminance
    - → Unlit / IsSky 머티리얼 Emissive에 직결
2. **태양 / 달 디스크**
    - SkyAtmosphereLightDiskLuminance(LightIndex)
    - 디스크 마스크(원형, 소프트 엣지) → ViewLuminance 위에 Add
3. **대기 안개 / 공기감(거리 기반)**
    - 구름/카드/파티클 등:
    - SkyAtmosphereAerialPerspective(WorldPosition) → RGB/A를 색/알파에 섞어서 공기감 추가
4. **라이트 방향**
    - SkyAtmosphereLightDirection(LightIndex) → dot(N, L), rim light, 구름 라이트 등
5. **고급: 직접 산란 계산 / 글로벌 라이팅**
    - SkyAtmosphereLightIlluminance : “지점에 도달하는 태양/달 조도(산란 전 단계)”
    - SkyAtmosphereDistantLightScatteredLuminance : “하늘 전체 산란 앰비언트”

---

## 그래프 예제

## Channel Mask Parameter 노드
머티리얼 인스턴스에서 **어떤 채널(R, G, B, A)을 사용할지 체크박스로 선택하게 해주는 노드**

1. 입력
    - Texture Sample의 RGB 또는 RGBA 핀이 연결
    - Vector4 (R, G, B, A) 혹은 Vector3 (R, G, B) 형태의 데이터를 받음
2. 속성 (Details Panel)
    - Parameter Name: 머티리얼 인스턴스에서 보일 변수 이름
    - Default R, G, B, A: 기본적으로 어떤 채널이 체크되어 있을지 설정
3. 출력
    - 선택된 채널의 값만 나옴
    - 만약 R 하나만 체크했다면? Scalar (float) 값 
    - 만약 R과 G를 체크했다면? Vector2 (float2) 값

---

## if 노드
두 입력값 (A와 B)의 크기를 비교하여, 결과에 따라 서로 다른 값을 출력하는 분기 노드

### 입력
**비교 대상**
1. **A (Input A)**: 비교의 기준이 되는 첫 번째 값 (LHS)
2. **B (Input B)**: 비교할 두 번째 값 (RHS)
    - A와 B는 단일 값(Scalar)일 수도 있고, 텍스처(Vector)일 수도 있다
    - **벡터인 경우 채널별로 비교**가 일어난다

**결과 후보**
조건이 맞을 때 내보낼 값을 여기에 연결

1. **A > B**: A가 B보다 클 때 출력할 값
2. **A == B**: A와 B가 같을 때 출력할 값
    - 주의: **부동 소수점(float) 오차 때문에 완벽하게 같기는 힘들다**
    - 디테일 패널에 **Equals Threshold라는 허용 오차(Epsilon) 속성**이 있음
3. **A < B**: A가 B보다 작을 때 출력할 값

```
보통 A >= B를 구현하고 싶다면, A > B 핀과 A == B 핀에 같은 값을 연결하면 됨
```

---



