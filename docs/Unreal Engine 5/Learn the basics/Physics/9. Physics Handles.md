---
layout: default
title: "9. Physics Handles"
parent: "Physics in UE"
nav_order: 9
---

# 9. Physics Handles
피직스 핸들은 **다이내믹 액터 (물리 시뮬레이션 중인 물체)를 잡고(Grab), 들고(Hold), 놓는(Drop) 데 사용하는 컴포넌트이다**

- 흔히 말하는 중력 건(Gravity Gun) / 물건 집어서 끌고 다니기를 구현할 때 사용

> Physics Handle Component의 Details에서 속성 조절도 가능
> - 속성을 조절하여 단단하게 고정된 느낌으로 따라옴, 출렁거리면서 따라옴 등등 구현

---

## Physics Handles 개념
1. **Simulate Physics = true 인 PrimitiveComponent** 를 잡아서 물리 힘/제약을 통해 **목표 위치(Target Location)** 로 끌고 온다
2. 물체는 여전히 **Dynamic** 상태 (중력/충돌/힘을 받음)
3. Physics Handle은 타겟 위치/회전을 따라가도록 강하게 잡아주는 일종의 보이지 않는 조인트 역할

---

## Physics Handles 그래프
- 기본 사용 패턴
```
1. 플레이어(또는 상호작용 주체) 액터에 Physics Handle 컴포넌트 추가
2. 입력(예: 마우스 왼쪽, E 키 등)에 맞춰 Grab / Release 로직 구현
```

### 사용 예시
1. **물체 감지 (Line Trace)**
    - 마우스 왼쪽 버튼(Left Mouse Button) 노드 추가
    - 해당 버튼을 눌렀을 때 실행되도록 Pressed 실행핀을 Line Trace 핀에 연결
2. **핸들 위치 업데이트 (Event Tick)**
    - **피직스 핸들이 캐릭터에 부착되어 있어도, 핸들이 "어디로 물체를 끌고 갈지"는 자동으로 계산되지 않음**
    - 코드로 매 프레임 알려줘야 함
    - Event Tick에서 `Set Target Location` 노드를 사용하여 **핸들의 목표 위치를 계속 업데이트**
3. **물체 잡기 (Grab Component at Location)**
    - Line Trace의 출력 핀과 이어진 Branch (if)가 true 일 때
    - Grab Component at Location의 실행핀과 연결
    - Line Trace의 `Break Hit result` 의 `Hit Component`를 사용해 잡아야 할 물체 설정
4. **물체 놓기 (Get Grabbed Component)**
    - `Get Grabbed Component` 노드로 현재 잡고 있는 컴포넌트가 있는지 확인
    - 있다면(Is Valid), `Release Component` 노드를 호출하여 놓아줌
5. **물체 던지기**
    - Release Component를 하면 잡고 있던 정보가 사라지므로, 놓기 전에 잡고 있던 컴포넌트를 **변수(Variable)로 저장(Promote)**해둠
    - 물체를 놓을 때 (Release) 저장해둔 잡기 변수에 `Add impulse`를 실행

---

## 주요 함수, 노드 정리
### Grab 관련
1. **GrabComponentAtLocation**
    - 위치만 잡고 회전은 자유롭게
2. **GrabComponentAtLocationWithRotation**
    - 위치와 회전을 모두 고정하거나, 강하게 따라가게
3. **GetGrabbedComponent**
    - 현재 Physics Handle이 잡고 있는 컴포넌트를 반환

### 타겟 제어
1. SetTargetLocation
2. SetTargetRotation
3. SetTargetLocationAndRotation

> 매 Tick 이걸 갱신하는 것이 핵심

### 해제
1. ReleaseComponent

---

# Physics Constraint
두 개의 물리 바디가 서로 어떻게 상대적인 위치와 회전을 유지할지 규칙을 잡아주는 시스템

## Constraint가 제어하는 것
하나의 물리적 바디에는 3개 위치 축(X/Y/Z) + 3개 회전 축(롤/피치/요) = 총 6가지 자유도가 존재한다

Physics Constraint는 6가지 자유도 각각을 제어한다

```
- Free (자유)
- Limited (각도/거리 제한)
- Locked (완전 잠금)
```

### 예시
1. **힌지(문 경첩)**
    - 한 축으로만 회전 Free / 나머지 회전 Locked / 이동은 Locked
2. **슬라이더(서랍)**
    - 한 축으로만 이동 Free / 나머지 이동 Locked / 회전 Locked
3. **스프링**
    - 특정 축 이동 Limited + 스프링 / 댐핑 값

---

# Constraint Component vs Constraint Actor
## Physics Constraint Component
블루프린트나 코드에 액터의 관절 연결에 쓰이는 컴포넌트

- 어느 액터에나 붙일 수 있음
- 같은 액터 안의 두 컴포넌트를 묶기 또는
- 다른 액터의 컴포넌트를 `SetConstrainedComponents()` 로 연결

---

## Constraint Actor
Constraint 하나만을 위한 전용 액터

- **레벨에 그냥 “Constraint Actor”로 배치**
  - ConstraintActor 의 **Component1 / Component2 슬롯**에 에디터에서 Actor/Component를 지정
- **하나 또는 두 개의 액터에 적용**
    - Actor 1: 빨간색 선으로 표시
    - Actor 2: 파란색 선으로 표시
- 레벨 디자이너 입장에서 “문과 벽을 연결”, “플랫폼과 기둥 연결” 처럼 **코드 없이 에디터에서 관절 배치를 쉽게 하기 위한 액터**

---

### 정리
```
Constraint Component → 코드/블루프린트로 관절 연결
Constraint Actor → 레벨 배치용, 비프로그래머 친화적
```

---

## Constraint Actor Limits
1. **선형 제약 (Linear Limits)**
    - 액터의 **위치 이동(Linear Motion)**을 제한
    - **축(Axis)**은 월드 좌표계가 아니라, **컨스트레인트 액터의 로컬 좌표계**를 따른다
    - 따라서 컨스트레인트 **액터를 회전시키면 제약 방향도 바뀜**
    - Limited 상태일 때 녹색 선으로 허용 범위가 표시
2. **각도 제약 (Angular Limits)**
    - 액터의 **회전(Angular Motion)**을 제한
    - Swing 1 Motion: 컨스트레인트의 로컬 Z축 회전 제한
    - Swing 2 Motion: 컨스트레인트의 로컬 Y축 회전 제한
    - Twist Motion: 컨스트레인트의 로컬 X축 회전 제한

> 선형 이동은 컨스트레인트 액터의 위치와 상관없음 (상대 거리 기준)
> - 각도 회전은 **컨스트레인트 액터의 위치가 회전축(Pivot)**이 됨
> - 액터 쪽으로 옮기면 회전 반경이 좁아지고, 멀리 두면 크게 돔

---

## Constraint와 Physics Handle의 관계
1. **Physics Constraint**
    - 두 바디 사이에 영구적인/일반적인 관절 관계 설정
    - 문, 차량, 체인, 기계 장치 등
2. **Physics Handle**
    - “잡았다 놨다” 하는 임시 Constraint
    - 내부적으로도 실질적으로는 “동적 Constraint”를 만들어서 Target Location/Rotation으로 끌어당김

즉 

```
Constraint Component/Actor : 항상 존재하는 관절 구조 (힌지/슬라이더/스프링)를 위한 일반적인 Constraint 시스템

Physics Handle : 코드로 만들어서, 매 Tick Target을 움직이는 특수한 Constraint 시스템
```

---

## Constraint를 이해할 때 알아두면 좋은 것들
1. **두 바디 모두 Dynamic이면**
    - 서로 영향을 주고받음 (둘 다 움직임)
2. **한쪽이 Kinematic/Static이면**
    - 그 쪽은 고정, 다른 쪽만 제약을 따라 움직임
    - 벽–문, 바닥–문짝 같은 케이스
3. **Breakable Constraint**
    - 일정 힘 이상이 가해지면 Constraint가 해제되도록 설정 가능
    - “문이 부서져서 떨어져 나가는” 연출 등
4. **Projection / Correction 설정**
    - Constraint가 너무 심하게 깨졌을 때 강제로 복구시키는 옵션들
