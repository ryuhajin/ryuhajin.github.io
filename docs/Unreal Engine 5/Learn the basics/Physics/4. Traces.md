---
layout: default
title: "4. Traces"
parent: "Physics in UE"
nav_order: 4
---

# 4. Traces
트레이스(Trace)는

1. **두 지점 사이를 검사하는 라인 트레이스(Line Trace)** 또는
2. **구/박스/캡슐 등의 충돌 형태를 이동시키며 검사하는 Shape Sweep**을 통칭

---

## 트레이스 기본 개념
### 라인 트레이스(Line Trace)
- 두 점(Start → End) 사이에 **1차원 선(Segment)**을 발사해 충돌 검사 수행
- 가장 비용이 적고 흔히 사용되는 유형

### 쉐이프 스윕(Shape Sweep)
- Sphere / Capsule / Box 같은 3D 형태를 **시작점에서 끝점으로 이동시키며 충돌 검사**
- Rigidbody 충돌 시뮬레이션 대신 “모양 기반의 선형 탐색”을 할 수 있음

---

## 트레이스 주요 용도
1. **시야 판정(Line of Sight)**
   - 적이 플레이어를 볼 수 있는지
   - 상호작용 가능한 오브젝트를 바라보고 있는지
2. **히트스캔(Hitscan) 무기 판정**
   - 권총/소총 등 빠른 발사체는 실제 물리 시뮬레이션 대신 트레이스로 즉시 타격 판정
3. **커서 기반 상호작용**
   - 마우스 커서 위치에서 Deproject하여 트레이스로 선택 처리
4. **AI 네비게이션 및 장애물 체크**
   - 특정 경로에 장애물이 있는지 확인
5. **물리 오브젝트를 사용하지 않는 커스텀 이동 충돌 검사**
   - 캐릭터 특수 이동 구현 시 Sweep 사용

---

## 트레이스 종류

1. **Single Trace**
   - 충돌 조건을 만족하는 **첫 번째 충돌만 반환**
2. **Multi Trace**
   - **충돌한 모든 HitResult를 배열로 반환**
   - 충돌 결과는 **Start → End 거리 순서대로 정렬**
   - Block이 발생하면 이후 Hit는 반환하지 않음

---

## 트레이스 충돌 처리 규칙  
트레이스는 충돌 시에 다음 세 가지 처리 방식 중 하나를 따름

| 설정       | 의미 |
|-----------|------|
| **Ignore** | 히트로 기록하지 않고 통과 |
| **Overlap** | Shape가 겹쳤음을 의미. <br>Single Trace: Ignore와 동일(기록 없음) <br>Multi Trace: 기록되지만 트레이스를 막지는 않음 |
| **Block** | 히트로 기록하고 트레이스를 중단 (더 이상 진행하지 않음) |

---

## 트레이스 채널(Trace Channel)
트레이스는 물체의 Collision Response에 따라 어떤 물체를 **막을지(Block)**, **겹침(Overlap)**으로 처리할지, **무시(Ignore)**할지 달라짐

### 주요 채널
1. **Visibility**
   - **시야, 감지, 상호작용, UI 선택 등에 사용**
   - 투명 오브젝트에는 Overlap/Ignore 설정
   - 단발성 이벤트나 HitScan 무기에 일반적으로 사용
2. **Camera**
   - **카메라와 플레이어 사이 장애물 판정**에 주로 사용 
   - (카메라 뒤로 지형이 들어올 때 카메라를 앞으로 이동시키는 용도)
   - 물리적 이동이나 발사체가 이동하는 경로를 시뮬레이션할 때 사용

> 실제 게임에서는 프로젝트 설정 → Collision에서  원하는 목적에 맞는 **맞춤형 채널**을 새로 만드는 경우가 많음

---

# 주요 트레이스 노드

## Line Trace by Channel
가장 기본적인 단일 선(라인) 충돌 검사 노드

- 지정한 시작(Start) → 끝(End) 위치 사이를 선으로 쏘아 충돌 여부를 검사
- 충돌 채널 (Visibility, Camera 등)에 따라 어떤 오브젝트를 히트할지 결정

### 입력

| 이름                      | 설명                             |
| ----------------------- | ------------------------------ |
| Start                   | 트레이스 시작 위치 (Vector)            |
| End                     | 트레이스 끝 위치 (Vector)             |
| Trace Channel           | 어느 충돌 채널을 사용할지 선택              |
| Trace Complex           | 복잡 충돌(Complex Collision) 검사 여부 |
| Ignore Self             | 자기 Actor 무시 여부                 |
| Actors to Ignore        | 무시할 Actor 리스트                  |
| Draw Debug Type         | 디버그 시각화 옵션                     |
| Hit Color / Trace Color | 디버그용 색상                        |
| Draw Time               | 디버그 표시 유지 시간                   |

### 출력

| 이름      | 설명                                           |
| ------- | -------------------------------------------- |
| Hit (return value)     | 충돌 여부 (Boolean)                              |
| Out Hit | FHitResult 구조체(충돌 지점, Normal, 충돌 Actor 등 포함) |

---

## Line Trace by Object
특정 Object Type 목록을 대상으로만 충돌 검사

- Object Channel 기반 필터링
- 입력/출력은 Line Trace by Channel과 유사

---

## Sphere / Box / Capsule Trace (Sweep)
`sphere trage by object` 등 이하 동일

### Sphere Trace
- 반지름(Radius) 기반 구 형태 Sweep
- Orientation 없음

### Box Trace
- Half Size(Extents) + Orientation(회전) 필요

### Capsule Trace
- Radius + Half Height + Orientation 필요

### 입력 기본 구성
| 입력 | 설명 |
|------|------|
| Start / End | Sweep 경로 |
| Radius / Half Size / Half Height | 형태별 크기 |
| Orientation | 회전(Box/Capsule) |
| Trace Channel 또는 Object Types | 필터링 방식 |
| Trace Complex | 복잡 충돌 검사 |
| Actors to Ignore | 무시 대상 |
| Draw Debug Type | 디버그 옵션 |

### 출력
- Single: Out Hit  
- Multi: Out Hits (HitResult Array)

---

## Get Hit Result Under Cursor / Get Hit Result Under Finger
마우스 커서 또는 터치 위치에서 3D 공간으로 Line Trace를 발사하는 노드

- “화면 중심”이 아니라 **실제 커서 좌표를 Deproject하여 그 방향으로 트레이스**

### 입력
| 이름            | 설명       |
| ------------- | -------- |
| Trace Channel | 충돌 채널    |
| bTraceComplex | 복잡 충돌 여부 |


### 출력
| 이름         | 설명               |
| ---------- | ---------------- |
| Hit Result | 마우스 위치 기반 Hit 정보 |

---

# 보조 개념 (추가적으로 알아두면 좋음)

### Complex vs Simple Collision
1. **Simple Collision**
    - 단순 상자/캡슐/컨벡스 등 최적화된 충돌
2. **Complex Collision**
    - 렌더 메시 기반의 상세 충돌
   - 비용이 더 크므로 필요할 때만 사용

### Physical Material 반환
- 충돌한 표면의 물리 재질(예: 금속/돌/흙)을 반환 가능
- 발자국 소리, 탄흔 효과 등 구현에 사용됨

### TraceTag
- 트레이스 호출에 태그를 붙여 Gameplay Debugger에서 시각화/디버깅 가능
