---
layout: default
title: "6. Collision Framework"
parent: "BluePrint"
nav_order: 6
---

# 6. Collision Framework
콜리전 시스템 이해하기

## Primitive component
콜리전은 **프리미티브 컴포넌트에서 시작된다**

- 아래의 컴포넌트들은 모두 **Primitive Component 클래스에서 파생**되었기 때문에 충돌 데이터를 가질 수 있음

```
Primitive components

- static mash components
- sphere components
- capsule components
- etc...
```
<br>
![](/images/UE5_collision_primitive.png)

> "액터(Actor)가 충돌한다"라고 말할 때, 정확히는 "액터를 구성하는 특정 프리미티브 컴포넌트가 충돌한다"는 의미
> - 충돌은 실제로는 Actor 간이 아니라 Component 간의 상호작용
> - 하나의 액터는 여러 개의 충돌 컴포넌트를 가질 수 있다

---

## Collision vs Query
충돌 시스템은 크게 두 가지 목적을 위해 사용

<br>

![](/images/UE5_collision_queries.png)

1. **Physics collision** :실제 물리적 접촉이나 교차 (intersection)
   - 실제 물리 법칙에 따라 객체가 부딪히고 튕겨나가는 등의 시뮬레이션을 위한 충돌
   - 객체에 중력, 힘을 가했을 때 다른 객체와의 접촉을 계산
2. **Spatial query** : “충돌이 일어날까?”를 계산하는 가상 검사
   - **LineTrace** : 지정한 방향으로 광선을 발사해 어느 물체에 부딪히는지 확인
   - **Shape Sweep** : LineTrace와 유사. 선이 아닌 특정 도형을 가지고 확인
   - **overlap** : 특정 영역 안에 다른 객체가 들어왔는지 여부를 감지

---

## Collision data

<br>

![](/images/UE5_collision_data.png)

1. **Collision Geometry**
    - 단순형(Simple): Box, Capsule, Sphere, Convex Hull → 빠름
    - 복잡형(Complex): 실제 메시 삼각형 기반 → 느림
2. **Collision Settings**
    - 엔진이 해당 Geometry를 어떻게 계산할지 정의
    - 쿼리 시스템, 피직스 시스템 두 계산 시스템 존재

---

## Collision Settings
**콜리전 세팅에 따라 콜리전 지오메트리를 처리하는 방식이 결정**된다

```
Query System (Overlaps, Traces 등)

Physics System (물리 시뮬레이션, 힘, 중력 등)
```

### Collision Enabled 설정
컴포넌트가 어떤 계산에 참여할지 결정

| 설정                            | 설명                           |
| ----------------------------- | ---------------------------- |
| **No Collision**              | 충돌 없음                        |
| **Query Only**                | 쿼리 시스템만 사용, 피직스 콜리전 없음 |
| **Physics Only**              | 피직스 시스템만 사용, 피직스(물리)의 결과로 콜리전을 감지 |
| **Query and Physics**         | 쿼리 시스템과 피직스 시스템 둘 다 사용 (비용 ↑) |
| **Probe Only (Contact Data)** | 콜리전의 결과로 힘(forces)을 가하지 않음<br> 피직스(물리)의 결과로 콜리전 데이터를 감지 (히트 콜백 실행)<br> 쿼리 시스템을 사용하지 않음 |
| **Query and Probe**           | Query + probe olny |

---

## Collision Object Type
충돌할 때 해당 오브젝트가 어떤 분류에 속하는지 정의 (예: 벽, 플레이어, 적의 총알)

### Collision Channel
콜리전 관점에서 이 컴포넌트의 타입을 식별. 채널에는 두 가지가 있다

1. **트레이스 채널 (Trace Channels)**
   - 라인 트레이스 등 쿼리용
   - 오브젝트(컴포넌트)에 할당될 수 없음
2. **오브젝트 채널 (Object Channels)**
   - 오브젝트 타입 지정용
   - 오브젝트(컴포넌트)에 할당

> WorldStatic, WorldDynamic, Pawn, PhysicsBody 등 미리 정의된 채널이 있음
> - 커스텀 채널도 생성 가능

---

## Collision Responses
**콜리전이 있는 모든 오브젝트는 콜리전 반응이 있음**

- 콜리전 리스폰스는 **다른 객체 콜리전 채널에 대해 이 객체가 어떻게 반응할지 결정**

1. **무시 (Ignore)**
    - 콜리전 상호작용 없음
    - 콜백(callbacks) 없음
2. **오버랩 (Overlap)**
    - 오브젝트가 **서로 통과함**
    - 오버랩 콜백을 트리거(발생)시킬 수 있음
3. **블록 (Block)**
    - 오브젝트가 **막힘**
      - 피직스(물리) 시뮬레이션 중일 경우
      - 스윕(sweeping) 중일 경우
    - hit 콜백 트리거 발생

---

## Collision Presets
위에서 본 **세 가지 설정(Collision setting, Object Type, Responses)을 조합해 하나의 프로필로 저장해둔 것**

### Collision Profile
콜리전 활성화, 콜리전 오브젝트 타입, 콜리전 응답

![](/images/UE5_collision_presets.png)

1. 콜리전이 있는 컴포넌트는 콜리전 프리셋 (Collision Presets) 속성을 가짐
2. 프리셋을 선택하면, 전체 콜리전 프로파일이 채워짐
3. 언리얼 엔진에는 여러 내장 프리셋이 있음
4. 커스텀 프리셋을 만들 수 있음
    - 개수 제한이 없음
    - 커스텀 콜리전 채널을 만드는 것보다 권장

> 프로파일을 설정하여 많은 수의 오브젝트에 쉽게 적용할 수 있다

---

## Collision Filtering
두 객체 **A와 B가 만날 때, 최종 충돌 결과를 결정 짓는 규칙**

- 두 오브젝트의 **Object Type과 Response를 비교하여 결과 결정**

### 📌 중요 규칙!

```
Ignore: 충돌 무시
Overlap: 겹침 이벤트 발생 (통과 가능)
Block: 막힘 (물리적 충돌 발생)
```

> A,B 충돌 시 가장 약한 결과 선택
> - Ignore < Overlap < Block
> - 즉, 둘 다 Block 해야 실제 충돌시 막힘 (Block) 발생

![](/images/UE5_collision_filtering.png)

### 예시
오브젝트 A (Pawn) 와 오브젝트 B (World Static) 가 만났을 때

1. B의 콜리전 오브젝트 타입(WorldStatic)에 대한 **A의 응답**
    - **A는 B를 블록(Block)** (A의 설정: `WorldStatic: Block`)
2. A의 콜리전 오브젝트 타입(Pawn)에 대한 **B의 응답**
    - **B는 A를 오버랩(Overlap)** (B의 설정: `Pawn: Overlap`)
3. 결과적인 콜리전 상호작용은 **오버랩(Overlap)**
    - 규칙: Block과 Overlap 중 덜 막는 Overlap 선택

---

## Collision Callbacks
충돌이 감지되면, 그 **결과를 게임 로직에서 처리할 수 있도록 이벤트가 발생**

> 등록된 콜리전 상호작용에 대한 응답으로 실행

![](/images/UE5_collision_callbacks.png)

1. **오버랩 콜백 (Overlap Callbacks)**
    - **On Component Begin Overlap, Actor Begin Overlap**
      - **오버랩(Overlap) 상호작용에 대한 응답**
      - 두 오브젝트 모두 **Generate Overlap Events (오버랩 이벤트 생성)**가 **true (참)**로 설정되어 있어야 함
2. **히트 콜백 (Hit Callbacks)**
    - **On Component Hit**
      - **블로킹(Blocking) 상호작용 또는 프로브(Probe)에 대한 응답**
      - 피직스 콜리전인 경우:
        - 히트 이벤트를 생성하는 컴포넌트는 **Simulation Generates Hit Events (시뮬레이션이 히트 이벤트 생성)**가 **true (참)**로 설정되어 있어야 함
      - 피직스 콜리전이 아닌 경우: **스위핑(sweeping) 이동**의 결과여야 함

---

