---
layout: default
title: "1. material for VFX"
parent: "Niagara"
nav_order: 1
---

# 1. material for VFX
나이아가라와 사용되는 머티리얼 설정

### Blend mode for VFX
1. translucent
    - 어두운 컬러감 사용 가능
2. additive
    - 검은색이 투명하게 렌더링
    - 밝음만 표현할 때 사용

### shading mode for VFX
1. default lit
    - PBR에서 사용되는 기본
    - 그림자와 빛 사용
2. unlit
    - vfx 머티리얼에는 unlit 사용
    - 그림자나 빛이 드리우지 않음

> 머티리얼 출력 노드의 two sided 활성화해야 앞뒷면 다 출력

---

# particle color
머티리얼과 연동되는 나이아가라 파티클

- [Niagara Particles & Materials](https://youtu.be/dhjmdXdjw2E?si=WtmdKRiSR-1lS751)

---

## 나이아가라 파티클과 머티리얼 흐름 구조

### 데이터 흐름 구조

1. **나이아가라(Niagara) : 입자 시뮬레이션 시스템**
   - **각 입자는 자신만의 속성(Attribute)을 가짐**
   - 즉, **파티클 하나하나가 고유의 위치 · 속도 · 색 데이터를 갖는다**
   - 예: Particles.Position, Particles.Velocity, Particles.Color, Particles.Age, Particles.Lifetime 등
2. **머티리얼(Material) : 렌더링 단계에서 픽셀 색을 결정하는 셰이더**
    - 입자의 데이터를 직접 계산하지 않음
    - **렌더러(Sprite, Mesh 등)가 전달한 속성 값을 픽셀 셰이더 입력으로 받음**

---

### 데이터 연동 방식

```
[나이아가라 시스템 (데이터 버퍼)] → [GPU 렌더러] → [머티리얼 (셰이더 코드)]
```

1. **나이아가라가 GPU 메모리에 거대한 버퍼(배열)를 만든다**
    - 이 버퍼에는 **수천 개 파티클 각각의 [위치, 색상, 나이, 속도, 크기...] 데이터가 저장**
2. **렌더링 명령이 내려지면, GPU는 이 버퍼를 읽음**
    - GPU는 파티클 1개(의 스프라이트 또는 메시)를 그릴 때마다, **머티리얼(셰이더 프로그램)을 실행**
3. 이때, 머티리얼 내부의 **Particle Color 노드는 "지금 그리는 파티클의 색상 데이터"를 버퍼에서 가져옴**
4. **Dynamic Parameter 노드는 "지금 그리는 파티클의 나이 데이터"를 가져옴**
5. 따라서 **똑같은 머티리얼 코드가 1000개의 파티클에 대해 1000번 실행되지만**
6. **매번 다른 입력값(Particle Color 등의 값)을 가지고 실행되기 때문에 모두 다르게 보임**

---

## 정리

```
입자 → 나이아가라에서 시뮬레이션(위치, 속도 등 계산)

나이아가라 렌더러 → 입자 데이터 GPU로 전달

머티리얼 → 각 입자 단위로 속성값을 읽어 픽셀 색 결정
```

> 즉, 데이터의 원천은 나이아가라이고, 머티리얼은 그 데이터를 읽음
> - 머티리얼이 반대로 입자 데이터에 직접 영향을 주는 일은 없다

---

# Dynamic Material Parameter
나이아가라 입자 속성과 별개의 **머티리얼 파라미터를 나이아가라에서 제어하기 위한 브리지**

| 항목   | 역할  | 주 데이터 흐름 |
| --- | --- | --- |
| **Particle Attributes** (`Particles.Color`, `Particles.Position` 등) | 입자 고유 데이터 | 나이아가라 내부 시뮬레이션용 |
| **Dynamic Material Parameters**  | 머티리얼에 보낼 커스텀 파라미터 | 나이아가라 → 머티리얼    |

---

## Dynamic Material Parameter 동작 방식
1. **나이아가라에서 값 생성**
    - **Dynamic Material Parameter 모듈**을 추가
    - 보통 0~3번 슬롯(Slot 0~3)에 **float4(벡터) 형태로 값을 지정**
    - 예:
        - Slot 0 = (Age / Lifetime)
        - Slot 1 = Particles.Velocity.x
        - Slot 2 = Random(0,1)
        - Slot 3 = User.Tint
2. **GPU 버퍼에 저장**
    - 각 입자의 **Dynamic Parameter 값이 GPU 버퍼에 포함**
3. **머티리얼에서 읽기**
    - **머티리얼 그래프의 “Particle Dynamic Parameter” 노드가 그 버퍼를 읽음**
    - 4개 벡터 슬롯(A~D)이 있으며, 각각 나이아가라의 Slot 0~3에 대응

---

## 응용 예시

| 목적 | 나이아가라 설정 | 머티리얼 사용 |
| --- | --- | --- |
| 색상 제어  | Dynamic Param 0 = `User.Color`     | BaseColor = `DynamicParam0.rgb`            |
| 밝기 제어  | Dynamic Param 1 = `(Age/Lifetime)` | Emissive = `DynamicParam1.r * 5`           |
| 텍스처 전환 | Dynamic Param 2 = `Random(0,1)`    | Lerp(Texture1, Texture2, DynamicParam2.r)` |

---

## 정리

```
“나이아가라가 머티리얼의 인풋을 직접 제어할 수 있게 하는 채널”

반대로, 일반적인 Particle Color나 Particle Velocity는
이미 표준 버퍼에 포함된 속성이라 Dynamic Parameter 없이도 바로 사용 가능
```

---

## niagara 만들 때 생각해보기
1. 어떤 렌더러를 사용할것인가
2. 어떤 엘리먼트를 사용할 것인가
3. 어떤 힘과 머티리얼을 사용할 것인가

---

## Heat Distorition
- translucent
- refraction
- normal map

머티리얼 refraction 모드 공부

---

## texture baking
언리얼에서 텍스쳐 굽기

### render target
- 머티리얼의 Emissive Color, Opacity만 그리기 가능
- 코드에 의해 트리거 된다
- 에디터와 런타임에 사용 가능하다

### redner target 만들기
1. 콘텐트 브라우저 우클릭 -> 텍스쳐 -> 렌더 타겟
2. `RT_` 접두사 설정
3. datails의 texture rander target 2D의 size x,y로 해상도 설정
4. rader target format으로 텍스쳐 포맷 설정

### 블루프린트로 render target 설정하기
1. 블루프린트에 함수 생성
2. **Draw material to render target** 노드
3. 해당 노드 드롭다운 메뉴에 렌더 타겟과 머티리얼 설정
    - 렌터 타겟, 머티리얼 각각 변수를 할당해 레퍼런스 불러오기
    - `is vaild` 함수로 둘 다 참일 때만 실행되게 만들기
4. 함수 실행하여 렌더 타겟에 머티리얼 굽기
    - 렌더 타겟 우클릭 -> create static texture 클릭
    - 텍스쳐 생성
5. **render target create static texture editor olny** 노드
    - 블루프린트 실행하면 바로 스태틱 텍스쳐 생성되게 만들기 

---

## noise 텍스쳐 언리얼에서 생성하기
머티리얼의 noise (input V3) 노드를 사용해 렌더 타깃으로 texture map 만들기

1. noise 노드에 texcoord 연결 (v2니까 0 append해서 v3으로)
2. noise details에서 만들고 싶은 노이즈 fuction 선택
3. levels 로 노이즈 좀 더 티테일하게 뽑을 건지 설정
4. tiling 체크하면 repeat size 조정 가능
5. noise 결과 power로 조정
6. 대비 cheapContrast로 조정
