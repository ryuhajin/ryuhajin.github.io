---
layout: default
title: "2. Anti-aliased"
parent: "Procedural Shapes, Patterns"
nav_order: 2
---

# 2. Anti-aliased
MF_antialiased 만들기

---

- **입력** : gradient(0~1 같은 그라디언트/또는 SDF 값)
  - 특정 임계값 **cutoff를 경계로 “계단(step)” 마스크를 만듦**
  - **해상도/줌 레벨에 관계없이** 경계가 항상 약 **1픽셀 두께로 부드럽게(anti-aliased) 보이게 ddx/ddy로 보정**

```
“한 픽셀과 한 픽셀의 옆에서 값이 얼마나 변하는지”를 ddx/ddy로 추정
경계 전환 폭을 항상 약 1픽셀 단위로 자동 보정!
```

---

## Anti-aliased 개념
- 어떤 값 gradient가 있을 때
- **특정 임계값 cutoff를 기준**으로
- 컷오프보다 **작은 쪽은 1(inside), 큰 쪽은 0(outside) 같은 이진 마스크**를 만들되
- **경계 픽셀에서는 0~1 사이의 “부분 커버리지”를 주는 것**

```
gradient = cutoff → v = 0 (경계)
gradient > cutoff → v < 0
gradient < cutoff → v > 0

[예시]
v = 0.5, g = 0.7

0.5 - 0.7 = -0.2 (v < 0)

---

v = 0.5, g = 0.3

0.5 - 0.3 = 0.2 (v > 0)

```

> 경계에서 0 / 안쪽(inside)에서 음수 또는 양수 / 바깥(outside)에서 반대 부호 = “경계까지의 signed 값”

---

## 그래프 수식
1. **임계값 정렬(경계가 0이 되도록 이동)**
    - v = cutoff - gradient
2. **화면공간 미분으로 “한 픽셀 옆에서 값이 얼마나 변하는지” 추정**
    - dx = ddx(v)
    - dy = ddy(v)
    - w = length(float2(dx, dy)) (≈ v가 1픽셀 이동할 때 변하는 크기)
3. **경계까지의 거리를 “픽셀 단위”로 정규화 (픽셀 단위 거리로 스케일)**
    - t = v / w
4. **적용범위로 변환 + 클램프**
    - out = saturate(0.5 - t)

---

### 최종식

$$

out = saturate\left(0.5 - \frac{cutoff - gradient}{\sqrt{ddx(v)^2 + ddy(v)^2}}\right)

$$

---

## 개념 잡기
이진 마스크의 보통 형태

- 경계 v 가 있을 때

```c++
output = v > 0 ? 1 : 0
```

---

## 적용범위 (coverage)
픽셀 하나는 점이 아니라 작은 면적

- **경계가 픽셀을 반쯤 가르면, 그 픽셀은 완전 흰색(1)도 완전 검정(0)도 아님**
- 따라서 픽셀 면적 중 **안쪽이 차지하는 비율만큼 중간값이 되어야 자연스러움!**
- **coverage**: “픽셀 면적 중 inside (cutoff보다 작은쪽) 가 차지하는 비율”
- **w**: coverage를 계산하기 위해 씀. 한 픽셀 이동에서 v가 변하는 크기

---

### 이해한 것
1. **cutoff = 내가 만들고싶은 도형 마스크의 경계**
    - 입력 값(gradient 또는 SDF) 중 어느 값이 경계인지를 지정
2. **v = 경계에 대한 signed 값(오프셋)**
    - v = cutoff - g
    - v는 0이 되는 경계값을 만드는 용도
    - 경계 : v = 0
    - 경계 안/밖 : v는 연속 값이고 부호 (+,-)만 바뀜
3. **t = v/w는 모든 픽셀에서 계산됨**
    - 경계 근처에서 결과에 영향을 남김
    - **−0.5 < t < +0.5 에서만 0 ~ 1 사이로 남음**
    - 즉 **경계 주변에서 부드러운 전이 만들기 = 안티앨리어싱**
4. **out = saturate(0.5 - t) = 클램프 (0 ~ 1로 잘라내기)**
    - **경계에서 멀리 떨어진 픽셀은 t가 커져서 out이 완전히 0 또는 1로 포화**
