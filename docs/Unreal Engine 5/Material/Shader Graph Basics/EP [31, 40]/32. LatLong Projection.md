---
layout: default
title: "32. LatLong Projection"
parent: "EP [31, 40]"
nav_order: 2
---

# EP 32 : LatLong Projection
Lat-Long(위도·경도) 맵핑 

---

## Environmaent Map 저장 방식
환경맵이란 **특정 지점에서 바라본 360도 주변 환경 전체를 담고 있는 텍스처를 의미한다**

```
큐브맵 (Cube Map)
- 정육면체의 6개 면(앞, 뒤, 좌, 우, 위, 아래)에 해당하는 6장의 2D 이미지를 사용해 360도 환경을 표현

Lat-Long 맵 (Latitude-Longitude Map)
- 위도 경도를 사용한 세계 지도처럼 생긴 2D 이미지
```

---

## HDRI (High Dynamic Range)
픽셀의 다이내믹 레인지 특성을 갖는 이미지 데이터

- LDR와 HDRI는 저장하는 데이터 형식이 다르다
- 데이터 형식(Data Format): 텍스처의 픽셀이 색상 정보를 저장하는 방식

1. **LDR (Low Dynamic Range)** : 우리가 흔히 아는 JPG, PNG 파일
    - 각 색상 채널(R, G, B)이 0 ~ 255 (또는 0.0~ 1.0)까지의 값만 가잠
    - 태양처럼 '흰색'보다 훨씬 밝은 정보는 저장할 수 없다
2. **HDRI (High Dynamic Range)** : .hdr, .exr 같은 파일
    - 픽셀이 실수(floating-point) 값을 가잠
    - 덕분에 1.0을 훨씬 초과하는 값 (예: 태양은 10000.0)을 저장할 수 있음
    - 이는 사실적인 조명과 반사를 계산하는 데 필수적

---

### Environmaent Map 용도
환경맵은 하늘과 같은 환경에 쓰이거나 환경 반사광에 쓰인다

1. **스카이박스 용도 (하늘과 같은 환경 그리기)**
   - 환경맵을 먼 배경에 렌더링
   - HDRI를 사용할 경우 1.0 이상의 밝은 값을 그대로 쓰지 않고
   - 톤 매핑(Tone Mapping)(감마 보정) 을 거쳐 0.0 ~ 1.0 범위로 압축하여 화면에 보여줌
2. **반사/조명 용도**
   - 물체의 반사 벡터 방향으로 샘플링하여 환경맵의 반사 색상을 가져옴
   - HDRI 환경맵의 1.0을 초과하는 밝은 값이 사실적인 빛 반사와 광원 계산을 가능하게 해줌

---

## LatLong Projection 개념
HDRI(High Dynamic Range Image) 환경맵은 실제 **환경을 위도(latitude)·경도(longitude) 좌표계로 평면에 투영한 것**

- 쉽게 말해 지구본을 지도처럼 펼친 것과 동일한 방식

```
U 좌표 = 경도 (Longitude)

V 좌표 = 위도 (Latitude)
```

따라서 HDRI 텍스처를 샘플링하면 구면상의 어떤 방향에 대해서도 대응되는 픽셀을 가져올 수 있다

> 즉, 물체 표면의 법선 방향이나 반사 벡터 방향에 따라 적절한 위치를 샘플링하면 “환경 반사”를 구현할 수 있다

---

## ReflectionVectorWS
표면의 특정 지점을 바라보는 내(카메라) 시선이, 그 표면의 법선(Normal)에 부딪혀 반사된다면 어느 방향으로 튕겨 나갈까? (반사) 를 알려주는 노드

### ReflectionVector input
카메라 벡터를 기본적으로(implicitly) 내장. 별도 핀 연결없이 자동으로 가져옴

- ReflectionVector input의 경우 Normal을 가져올지 말지 결정함

1. **'Normal' 핀을 비워둔 경우 (기본값)**
    - 입력 1 (암시적): CameraVectorWS (자동으로 가져옴)
    - 입력 2 (기본값): WorldNormal (자동으로 가져옴)
    - 결과: 3D 모델 메쉬의 기본 법선을 기준으로 한 반사 벡터 (매끈한 표면의 반사)
2. **'Normal' 핀에 노멀 맵을 연결한 경우 (일반적)**
    - 입력 1 (암시적): CameraVectorWS (자동으로 가져옴)
    - 입력 2 (연결됨): 우리가 연결한 '노멀 맵'의 법선 벡터 (물론 월드 공간으로 변환된 값이어야 함)
    - 결과: 노멀 맵의 울퉁불퉁한 표면 디테일을 기준으로 한 반사 벡터 (범프 매핑이 적용된 반사)

---

# 그래프 예제

```
1. World Position, Camera Direction, Normal → Reflection Vector
2. Reflection Vector의 x, y, z를 분리
3. u = atan2(x, -y) + 1.57 (π/2)
4. v = acos(z) + π
5. (u, v) 결합
6. u * 0.159155, v * 0.31831  → [0~1] 정규화
7. Texture Sample의 UV로 연결
```
