---
layout: default
title: "31. MatCap Materials"
parent: "EP [31, 40]"
nav_order: 1
---

# EP 31 : MatCap Materials

---

**Material Capture(재질 캡처)의 줄임말**로 리얼타임 렌더링에서 반사광이나 조명 효과를 아주 저비용으로 흉내 내는 고전 쉐이딩 기법이다

## Material Capture 개념
1. **카메라 뷰 기준**으로 고정된 구형 텍스처(sphere map)를 오브젝트 **표면에 투영**
2. 마치 환경 반사가 있는 것처럼 보이게 만든다

- Material Capture → 실제 조명 환경을 캡처하거나 페인트한 구형 이미지를 사용

- 오브젝트 표면의 **노멀 방향을 이용해 카메라 방향을 기준으로 텍스처의 어떤 부분을 보여줄지 결정**함

> 복잡한 reflection probe나 SSR 없이도 저비용으로 반사 효과를 낼 수 있음

---

## Material Capture 특징

| 항목     | 설명 |
| ---| --- |
| 반사     | 실제 환경 반사는 아님 — 텍스처 안에 반사 정보가 미리 그려져 있음 |
| 카메라 기준 | 카메라 뷰에 고정되어 오브젝트가 회전해도 반사가 따라오는 효과  |
| 성능     | 매우 가벼워 모바일 · VR에서 자주 사용됨 |
| 텍스처    | 구형(spherical) 이미지. ZBrush나 Blender matcap도 동일 개념 |
| 활용     | 메탈 재질, 셰이딩 스타일라이징, 퀵뷰 프리뷰 머티리얼 등 |

---

# 그래프 예제

예전 EP 10에서 만들었던 Matcap

1. World Normal → View Space로 변환
2. [0~1]로 맵핑해서 Matcap 텍스처 샘플링

- 카메라가 오브젝트를 정면에서 볼 때는 잘 작동
> 하지만 카메라를 회전시켜 오브젝트를 비스듬히 봤을때 왜곡 발생


### 문제점 발생 이유
```
UV_old = 0.5 · N_view.xy + 0.5

뷰 공간으로 변환한 법선 N의 x,y만으로 구를 펼친 듯한 UV를 만들고 샘플링
```

- 위 식은 뷰 벡터를 쓰지 않기 때문에 카메라가 옆으로 이동해도 UV가 거의 그대로임
- 결과적으로 텍스처가 카메라 평면에 고정된 것처럼 보여 비정상적으로 왜곡됨

> 즉, 화면에 ‘스티커’처럼 붙여 둔 셈이라 물체와 시점이 바뀌어도 텍스쳐가 움직이지 않음

## Material Capture 예제 (개선 방식)
1. world position 노드 불러오기
2. Transform Position 노드로 world space → view space로 변환
3. 2번 벡터 Normalize
4. Vertex Normal WS 노드 불러오기
5. Transform Vector 노드로 world space → view space로 변환
6. 3번 5번 벡터 Cross product
7. Split Components로 R,G split
8. Append Many로 G → R, R → G
9. * 0.5, + 0.5 로 [0~1] 맵핑
10. 텍스쳐 샘플의 UV로 사용
