---
layout: default
title: "22. Shader Performance Measurement 2"
parent: "EP [21, 30]"
nav_order: 2
---

# EP 22 : Shader Performance Measurement 2
정확한 Shader 성능 측정 방법

## 측정 환경 구성 (Unreal Engine 기준)

### 기본 장면 구성
1. **빈 Level 생성** (Empty Level)
2. **Plane 배치** → 좌표 (0,0,0)
3. **Directional Light 배치**
   - 위치는 중요치 않지만, 광원은 필수
4. **Camera 배치**
   - Plane 중심을 향하게 회전 (90°)
   - 카메라 프리뷰에 Plane만 가득 차도록 위치 조정
5. **테스트할 Material 적용**
   - 추후 다른 머티리얼을 교체해 반복 측정 가능

📌 이렇게 만든 간단한 테스트 씬은 성능 측정 전용으로 재사용할 수 있음

---

## 타겟 하드웨어에서 실행

- 성능 측정은 반드시 **실제 목표 플랫폼에서 실행해야 함**  
  - 예 : 안드로이드 타겟이라면 Windows 측정 결과는 무의미

### 패키징 설정
- `Project Settings → Maps & Modes`에서 테스트 맵을 **Startup Map**으로 지정
- `Package Project` 메뉴에서 타겟 플랫폼 선택
- 빌드 구성:
  - ✅ Shipping 빌드 (성능 측정용)
  - 🚫 Development 빌드는 디버그 기능 때문에 느림

- SDK가 설치되어 있어야 패키징 가능 (Visual Studio + .NET SDK 등)

---

## Editor가 아닌 패키지 실행 파일로 테스트
에디터에서의 FPS는 부정확하다

- 에디터는 다양한 디버깅 및 편집 기능을 포함하고 있어 실제 성능보다 느리게 나옴
- **빌드 후 실행 파일에서 측정해야 정확한 수치 확보 가능**
- Windows에서는 `Win + G` → Xbox Game Bar로 FPS 측정 가능

---

## 프레임 시간(Frame Time) 기반으로 성능 보기
- 단순 FPS보다는 **Frame Time(ms)** 이 정확
- 예:  
  - 120 FPS → 약 8.3 ms/frame  
  - 60 FPS → 약 16.6 ms/frame

---

$$
\text{Frame Time(ms)} = \frac{1000}{\text{FPS}}
$$

---

- 셰이더를 수정할 때마다 패키징 → 실행 → 프레임 시간 비교로 성능 차이를 검증

---

## V-Sync 및 그래픽 품질 설정
- V-Sync가 켜져 있으면 FPS가 모니터 주사율(예: 60Hz)에 고정됨 → **정확한 측정 불가**
- `Project Settings → Quality`에서 V-Sync를 **Don't Sync**로 변경
- **Quality Level을 Low로 설정**해 불필요한 렌더링 비용 제거
  - Ambient Occlusion, Volumetrics, Fog 등 비활성화

---

## 정밀 측정 도구 사용 — PIX
Microsoft의 GPU 분석 툴 (Windows DirectX)

### PIX의 역할
- GPU에 전달되는 Draw Call / Shader Dispatch를 **프레임 단위로 캡처**
- 개별 Draw Call의 실제 소요 시간(nanosecond 단위)을 분석
- Unreal 및 Unity 모두 지원

### 사용 절차
1. Windows에서 **Developer Mode** 활성화
2. (NVIDIA) Control Panel → Developer Settings → `Allow GPU performance counters`
3. PIX에서 `Launch Win32`로 빌드 실행
4. GPU Capture → Frame 선택
5. Timeline에서 **G-Buffer Pass → DrawIndexedInstance** 항목 확인
6. Duration 값이 셰이더 렌더링 시간(ns)

---

$$
\text{ns} \div 1{,}000{,}000 = \text{ms}
$$

---

예: `794,848 ns ≈ 0.794 ms`

---

## 결과 해석
- Frame Time이 낮을수록 성능이 좋은 것
- 동일한 테스트 씬에서 **머티리얼만 변경하여 비교**하면 순수 셰이더 비용 차이를 알 수 있다
- Instruction Count로는 예측할 수 없었던 **실제 GPU 비용**을 수치로 확인 가능

---

## 기타 플랫폼

- Xbox : PIX 지원
- PlayStation : Razor
- iOS/Android : 벤더별 프로파일러 (Xcode GPU Frame Debugger, Snapdragon Profiler 등)
- PC/NVIDIA : NSight Graphics, RenderDoc 등 대체 툴 가능
- Unreal Insights

---

## 정리

1. 성능 측정은 반드시 **패키징된 빌드**로 해야 한다
2. 측정 환경은 Plane + Light + Camera로 단순화할 것
3. 정확한 측정은 **Frame Time** 또는 **PIX / GPU Profiler**를 통해 수행
4. 타겟 하드웨어에서의 결과만이 의미가 있다.
5. 작은 Shader 변경도 **실제 소요 시간으로 검증**해야 한다

---
