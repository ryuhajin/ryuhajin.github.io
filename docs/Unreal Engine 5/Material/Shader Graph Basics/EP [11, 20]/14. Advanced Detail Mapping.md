---
layout: default
title: "14. Advanced Detail Mapping"
parent: "EP [11, 20]"
nav_order: 4
---

# EP 14 : Advanced Detail Mapping
**여러 재질(천, 가죽, 리넨 등)을 가진 복합 오브젝트에서 디테일 노멀을 효율적으로 관리**하는 방법

- 캐릭터처럼 여러 재질(데님, 가죽, 리넨 등) 이 섞인 모델에는 하나의 detail map만으로는 부족
- 각 재질별로 다른 질감(섬유 패턴, 가죽 요철 등)을 표현해야 함

---

## Texture Array
여러 텍스처를 하나의 스택(Stack)으로 묶은 데이터 구조

- 한 파일 안에 여러 텍스처를 층(slice) 단위로 저장한 것

### 생성하기
1. 콘텐트 드로어 우클릭
2. 생성 목록에서 텍스쳐 선택
3. 텍스쳐 2D Array 선택
4. 텍스쳐 2D Array 창에서 Source Textures의 + 버튼으로 텍스쳐 추가

- 텍스쳐를 추가하면 견본처럼 나눠서 보여줌

---

## Texture Array Coordinate
Texture Array는 UV좌표(U,V)에 더해 W값(slice index)을 요구

```
UV → 표면 좌표
W → 배열 내 어떤 텍스처를 쓸지 선택 (0,1,2,3,…)
```

### 그래프 구성
1. Texture Coordinate 노드
2. 스칼라 노드에 texture Array 인덱스 값 입력
3. 1번 2번 Append
4. texture Sample UVs에 입력

- W값 (스칼라 노드) 변경으로 원하는 디테일 텍스처를 선택 가능

---

## Mask
포토샵에서 **마스크 제작**
- 흑백 텍스처로 각 구역을 구분
- 4개 재질이라면 0~255 범위를 4구간으로 나눔
- n개 재질이라면 0~255 범위를 n구간으로 나눠야 함
- 각 구역을 해당 밝기로 칠함

```
0–63   → Index 0
64–127 → Index 1
128–191→ Index 2
192–255→ Index 3
```

### 그래프 구성
1. Mask를 텍스쳐 샘플로 불러옴
2. 0~1 범위의 마스크를 인덱스 범위 (여기서는 0~3) 범위의 정수로 변환
3. 이 값을 w좌표로 넘겨 texture Array의 텍스쳐 선택

```
MaskTexture → Multiply by 3 → Round → W input으로 사용
```

> 마스크 밝기에 따라 재질 노멀 입히기 가능

### Round를 쓰는 이유?
마스크는 그레이 스케일. 이 값은 0.0 ~ 1.0 사이의 연속값(float) 으로 표현

- 가장 가까운 정수로 반올림해서 index 값을 얻음

| 구역         | 밝기 (mask) | 곱하기 3 후 값 |
| Denim 영역   | 0.10      | 0.3       |
| Felt 영역    | 0.33      | 0.99      |
| Leather 영역 | 0.61      | 1.83      |
| Linen 영역   | 0.85      | 2.55      |

---

## 정리
- **각 재질마다 별도 샘플** → 비효율
- **Texture Array 사용, 마스크로 선택** → 샘플 수 감소, 확장성↑, 유지보수 용이

---

# KEYWORD NOTE
round 와 같은 올림 함수 헷갈려서 정리

| 함수  | 정의 | 입력 `1.7` → 출력 | 주요 셰이더 용도 | 설명  |
| --- | --- | --- | --- | --- |
| **`frac(x)`**  | 소수부만 취함 | 0.7 | UV 반복, 노이즈 타일링 | 소수점 이하 부분만 남김. <br> 주기적 패턴을 만들 때 사용|
| **`floor(x)`** | 가장 가까운 아래 정수 | 1 | 셀 구분, 스텝 분할    | 항상 내림. <br> UV를 정수 구간으로 자를 때 사용 |
| **`ceil(x)`**  | 가장 가까운 위 정수   | 2 | 셀 구분, 보정 계산    | 항상 올림. <br> 한계값 포함 계산에 유용 |
| **`round(x)`** | 가장 가까운 정수로 반올림 (0.5는 짝수 쪽으로) | 2 | 인덱스 선택, 스냅 조정  | 0.5 기준 반올림. <br> Texture Array 슬라이스 선택 등에서 사용 |