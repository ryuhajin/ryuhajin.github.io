---
layout: default
title: "12. Blending Normal Maps"
parent: "EP [11, 20]"
nav_order: 2
---

# EP 12 : Blending Normal Maps
전체 형태용 Base Normal 과 표면 디테일용 Detail Normal 합치기

## 두 Normal Map을 왜 섞는가
- 바위 표면 전체 형태용 Base Normal
- 확대 시 보이는 세부 질감용 Detail Normal
→ 두 개를 적절히 blend해야 **카메라 거리에 따라 자연스러운 질감 유지**

---

# Normal Blending 예제

## Simple
1. R, G 채널만 더함 (Base.R + Detail.R, Base.G + Detail.G)
2. Z는 Scalar `1`로 고정
3. R, G Append Z
4. Normalize 없이 바로 출력

- **장점** : 가장 저렴
- **단점** : Normal 세기가 약해지고, 깊이감 손실
- **적용 사례** : 물결, 빗방울 등 세밀도보단 속도가 중요한 경우

---

## UDN (Unreal Developer Network)
Simple과 거의 동일하나 Z에 1 대신 **Base Normal의 Z 채널 사용**
- 마지막에 Normalize 후 노멀에 연결

- **장점** : Simple보다 대비가 강하고, 경계가 뚜렷
- **단점** : Detail Normal의 Z채널 정보는 무시
- **적용 사례** : 품질이 중요한 물체 표면

---

## Whiteout
1.  R, G 채널만 더함 (Base.R + Detail.R, Base.G + Detail.G)
2.  Z 채널끼리는 곱함 (Base.Z * Detail.Z)
3.  1번 2번 Append Vector Z
4.  Normalize 후 출력

- **장점** : UDN보다 Detail 질감이 강하게 표현됨
- **단점** : UDN보다 비용 비쌈
- **적용 사례** : 캐릭터, 근거리 촬영 등 고품질 필요 시

---

## RNM (Reoriented Normal Mapping)
두 normal map을 단순히 더하면 벡터 왜곡이 생긴다
> RNM은 detail normal을 base normal의 기울기에 맞춰 회전시킨 뒤 합치는 방식이다

### Detail Normal에 -1을 곱하는 이유?
detail normal의 XY 성분을 **base normal의 로컬 좌표계에 맞게 뒤집어주어 두 tangent space 간의 좌표 정렬을 근사하기 위한 수학적 보정**

1. Base의 Z축에 +1, R,G 그대로
2. Detail의 R,G * -1, Z축 그대로
3. 1번 2번 dot
4. Dot 결과 * Base Vector
5. Base Z + 1 * Detail Vector
6. 4 subtract 5
7. Normalize 후 출력


- **장점** : Whiteout보다 더 정교한 방향 유지
- **단점** : 비싼 연산 비용
- **적용 사례** : 최고 품질 필요할 때 (예: 캐릭터 얼굴, 금속 표면)

> Blend Angle Corrected Normals는 위 RNM을 내부 알고리즘으로 씀