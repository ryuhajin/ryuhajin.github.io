---
layout: default
title: "13. Detail Normal Mapping"
parent: "EP [11, 20]"
nav_order: 3
---

# EP 13 : Detail Normal Mapping
고해상도 텍스처(2048x2048)라도 UV가 0–1 공간이면 근접 시 픽셀 밀도가 부족하다

- 따라서 근거리에서 선명한 질감 유지하기 위해 Detail Texture (V4) 를 추가한다

---

## Detail Normal Texture
RGBA 채널에 각각 필요한 요소를 넣는다

| 채널      | 내용                   | 용도        |
| **R,G** | Normal의 X,Y 성분       | 세부 굴곡 방향  |
| **B**   | Roughness multiplier | 거칠기 세부 조정 |
| **A**   | Color overlay mask   | 색상 밝기 보정  |

### 압축 설정
- **Compression**: BC7 (4채널 데이터용 / Normal Map 아님)
- **sRGB**: Off (색상 데이터가 아님)

---

## Material Graph 과정
### UV tile
`TextureCoordinate × 8.0` → Detail 텍스처 8배 타일링
- 2048×2048 텍스처 × 8 = “실질적 16384 해상도” 효과

### Normal (RG 채널) 변환
Detail Texture의 RG값은 [0,1] 범위 → 벡터 [-1,1] 범위로 변환 필요

```
Detail.xy = (Detail.xy * 2) - 1
Z = DeriveNormalZ(Detail.xy)
```

- `DeriveNormalZ` 노드로 Z 계산
- 결과: float3 Normal 복원

### Normal 결합
`Blend Angle Corrected Normals` 노드
- Base Normal → A 입력
- Detail Normal → B 입력
- **근접 확대 시에도 디테일 유지**

### Roughness 세부 조정 (B 채널)
1. Detail.B
2. Base.Roughness
3. 1번 2번 Multiply
4. Roughness로 결과값 입력

효과: 물체의 반사율이 높아지고 디테일이 추가됨

### Color Overlay (Alpha 채널)
`Blend Overlay` 노드 사용

```
Base = Albedo.RGB
Blend = Detail.A
```

효과: 색상 질감에도 미세한 콘트라스트 추가

---

## 정리
한 장의 Detail 텍스처의 R,G,B,A 채널에 Normal, Roughness, Color 넣기

> 샘플 수 1회 추가만으로 고해상도 효과 확보!

---

# KEYWORD NOTE
처음보는 노드 적어두기

## DeriveNormalZ
**Normal의 X, Y 성분으로부터 Z 성분을 재구성(reconstruct)하는 노드**

### 작동 원리

- 정상적인 tangent-space normal은 단위 벡터이므로 다음 관계를 만족

---

$$x^2 + y^2 + z^2 = 1$$

---

- x,y를 알고있으므로 z는 다음과 같이 계산됨

---

$$z = \sqrt{1 - x^2 = y^2}$$

---

- 입력값이 (x, y)이면 출력은 `(x, y, sqrt(1 - x² - y²))`
> 노멀 벡터의 길이를 1로 복원

### 사용 이유
Detail texture에서는 메모리 절약을 위해 R,G만 저장(X,Y) 하고, Z는 런타임에 계산

---

## Blend Overlay
**두 색상(A, B)을 포토샵의 Overlay 블렌딩 모드처럼 합성**

- 디테일 질감 강화나 색상 대비 증가에 사용

### 작동 원리
Overlay는 픽셀별로 밝기(0.5 기준)에 따라 다른 연산

---

$$
\text{Overlay}(Base, Blend) =
\begin{cases}
2 \times Base \times Blend, & Base < 0.5 \\[6pt]
1 - 2 \times (1 - Base) \times (1 - Blend), & Base \ge 0.5
\end{cases}
$$

---

- Base가 어두울 때 → 더 어둡게
- Base가 밝을 때 → 더 밝게
- 중간값(0.5)은 거의 변화 없음

> 밝은 영역은 하이라이트 강화, 어두운 영역은 음영 강화 효과

---

