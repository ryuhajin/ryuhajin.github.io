---
layout: default
title: "16. Length & Distance"
parent: "EP [11, 20]"
nav_order: 6
---

# EP 16 : Length & Distance
Length와 Distance 노드의 수학적 개념과 활용 사례

## Length vs Distance

| 노드  | 입력    | 결과   | 설명  |
| **Length**   | 벡터 1개 | 스칼라(길이) | 벡터의 크기(길이)를 계산함 |
| **Distance** | 점 2개  | 스칼라(거리) | 두 점 사이의 거리를 계산함 |

---

$$
Length(\vec{v}) = \sqrt{v^2_x + v^2_y + v^2_z}
$$

---

$$
Distance(p_1,p_2) = \sqrt{(x_2 - x_1)^2 + (y_2 - y_1)^2 + (z_2 - z_1)^2}
$$

---

- 두 노드는 수학적으로 완전히 **동일한 결과를 냄**
- 단지 **입력 방식만 다르다**

---

# Length & Distance 노드 사용 예제
## Scene Depth 측정 (Camera → Pixel 거리)

**distance 노드 사용**
1. camera position 노드 불러옴
2. Absolute World Position 노드 불러옴
3. Distance 노드의 A, B 입력에 각각 1번, 2번 연결
4. Divide 노드로 원하는 비율의 scalar 값 넣기 (예 : 5) 
5. 4번의 출력값을 Base Color, Emissive Color 에 연결

**Vector Length 노드 사용**
1. camera position 노드 불러옴
2. Absolute World Position 노드 불러옴
3. Subtract로 A - B
4. 3번의 출력을 Vector Length 노드 (V3)에 입력
5. distance 노드와 동일하게 Divide 노드로 원하는 비율의 scalar 값 넣기 (예 : 5)
6. 5번의 출력값을 Base Color, Emissive Color 에 연결

> 두 노드 다 카메라가 가까울수록 어둡고, 멀수록 밝아짐

- 카메라 거리가 1 : `1/5` = 0.2 (0에 가까움 = 어두움)
- 카메라 거리가 10 : `10/5` = 2 (1에 가까움 = 밝음)

---

# Local Position
오브젝트의 **로컬 좌표계에서 현재 픽셀(혹은 정점) 의 위치 벡터를 반환하는 노드**

- 입력 없음 : 자체적으로 현재 정점의 좌표를 가져옴

## Local Position 출력
출력 핀이 두 개 있음

### Local Position
머티리얼에서 **World Position Offset (WPO)를 썼다면, 그 Offset이 반영된 후의 값**

- 즉 애니메이션이나 디스플레이스먼트가 적용된 후 위치
- 예 
  - 오브젝트 메시 꼭대기 z : 100
  - 바람 offset : 30
  - 출력 : 130 (offset 반영)

### Local Position (Excluding Offsets)
머티리얼에서 아직 **변위가 적용되기 전 오브젝트 메시의 로컬 좌표**

- **WPO에 어떤 값을 주더라도 이 출력은 변하지 않음**
- 예 
  - 오브젝트 메시 꼭대기 z : 100
  - 바람 offset : 30
  - 출력 : 100 (원래 위치 출력)

위 Local Position이 5.2버전에서 못 쓰는 노드가 되어서 직접 MF 만들어보기로 함

1. Local Position 만 반환하는 output
2. Absolute World Position 을 world 에서 local로 변환하여 반환하는 output

---

## Local Position 기반 마스킹 (Foliage / Wind Animation)

## 그래프 과정
### 1. 원본 높이 마스크 만들기
피벗이 중앙이라 Z 값은 -135~135 범위

- 우리가 원하는 건 0 ~ 270 (= 바닥에서의 높이)
- Z값을 바닥과의 거리로 바꿔서, **이 버텍스가 바닥으로부터 몇 cm 떨어져 있는지를 계산**
  
> distance 노드에 local Z축과 -135를 input으로 넣어 버텍스와 바닥의 거리 계산
> - Distance(Z, -135) = Z에서 바닥까지의 거리 = 0 ~ 270 범위

| **Z(로컬)** | **Distance(Z, -135)** | **의미**    |
| -135  | 0                 | 바닥    |
| 0     | 135               | 중간 높이 |
| 135   | 270               | 맨 위   |

- Distance로 구한 Z값에 `0.001` 곱하기
- 언리얼 엔진에서 **1.0 유닛 = 1cm**
- cm → m로 스케일 변환

| **cm (Z값)** | **height01 (×0.001)** |
| 0       | 0.0               |
| 135     | 0.135             |
| 270     | 0.270             |
| 1000    | 1.000             |

### 정리

| **항목**              | **값**              | **설명**           |
| 언리얼 기본 단위       | 1 = 1cm          | 오브젝트 높이도 cm 단위 |
| Z값 범위 예 (270cm) | -135 ~ +135      | 피벗 중앙일 때     |
| 0.001 곱하기 목적    | cm → m 변환        | 270cm → 0.27 |
| 결과              | 0~1에 가까운 값으로 정규화 | 머티리얼 연산에 적합  |

---

### 2. 흔들거리는 애니메이션 생성
1. time 노드에 sine 노드 연결
2. 원하는 속도 스칼라 값을 sine 노드와 곱함
3. **2번의 출력 값을 위 높이 마스크와 곱함**

> 높이에 따라 **흔들림 강도를 조절**

- **바닥** : 0이 곱해져서 흔들림 없음 (루트 고정)
- **중간** : 절반만 흔들림
- **위쪽** : 사인 값 그대로 흔들림 (최대)

---

## 정리

| **요소**                         | **역할**                         |
| `sin(Time)`                | 전체 메시를 주기적으로 흔드는 값         |
| Z 스케일 변환   | 높이에 따른 흔들림 강도 조절 (0~1)     |
| `sin(Time) * Z 스케일 변환 값` | 바닥은 고정, 윗부분만 흔들리는 바람 효과 구현 |

---

