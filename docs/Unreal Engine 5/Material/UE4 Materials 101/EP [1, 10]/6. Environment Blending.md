---
layout: default
title: "6. Environment Blending"
parent: "EP [1 , 10]"
nav_order: 4
---

# EP 6 : Environment Blending
텍스쳐 base,src를 텍스쳐 샘플로 가져와 lerp로 보간

## lerp

```c++
Result = A * (1 - Alpha) + B * Alpha
```
- Alpha : 가중치

**알파가 - 1 ~ 0 또는 1 이상이면?**
- α < 0 : B의 가중치가 음수. 선분 밖에서 A 바깥 방향으로 나감
- α > 1 : A의 가중치가 음수. 선분 밖에서 B 바깥 방향으로 나감

1. `vertexNormalWS.z` alpha
기하학적 경사 (정점 단위). 노멀맵 미세 기복은 반영 안됨
- 성능 저렴. LOD 바뀌어도 일관성 높음
- 지오메트리의 큰 스케일 경사로 블렌드

2. `노멀 텍스처를 월드 벡터로 변환 후 z` alpha
기하 + 표면세부 (노멀맵) 경사 (픽셀 단위)

**기하가 표함되는 이유?**
노멀맵을 월드 공간으로 변환할 때, 아래와 같은 방식으로 기하학적 법선(N_geom)이 반드시 곱해짐

```
// TBN 변환
N_world = T * N_tangent + B * N_bitangent + N_geom * N_tangentZ
```

- 비용 높음(TBN 변환과 정규화 비용). 거리에 따라 반짝일 수 있음
- 미세 요철까지 블렌드에 쓰고 싶을 때

---

## vertexNomalWS (World Space)
VertexNormalWS의 각 축 범위는 [-1, 1]

**vertexNomalWS을 Alpha로 쓸 때**
- Alpha는 0 ~ 1 범위에서 의미가 있음 (두 비율의 합이 항상 1)
- 따라서 보통 `saturate()` (clamp 0 ~ 1)나 `remap` 을 해서 alpha에 사용함
- `clamp()`, `saturate()`의 경우 마이너스 축을 그냥 날려버림 → 음수 방향 노멀 구분 못함
- 음수 방향도 표현하고 싶으면 remap 방식 쓰기

---

## clamp()
0보다 작으면 0, 1보다 크면 1, 그 사이면 그대로 반환

- 범용적: 임의의 범위 clamp(x,min,max)도 가능

> saturate(x) = clamp(x,0,1)
> - clamp는 범위 임의 지정 가능, saturate는 항상 [0,1]

---

## TransformVector
좌표 공간 변환

1. Input Vector: 변환하고 싶은 float3 벡터를 연결
2. Source Space: 현재 입력된 벡터가 어떤 좌표 공간 기준인지 지정 (예: World)
3. Destination Space: 어떤 좌표 공간으로 변환할 것인지 목표를 지정 (예: Tangent)

### 좌표공간

- 로컬 공간 (Local Space or Object Space)
  - 오브젝트 자기 자신을 기준으로 하는 좌표계. 오브젝트의 피봇(pivot)이 원점(0,0,0)
- 월드 공간 (World Space)
  - 게임 레벨 전체를 아우르는 절대적인 기준의 전역 좌표계
- 뷰 공간 (View Space or Camera Space)
  - 카메라의 시점을 기준으로 하는 좌표계
- 탄젠트 공간 (Tangent Space)
  - 오브젝트 표면의 한 점을 기준으로 하는 좌표계입니다

---

## Normal Add Scalar
셰이더에게 방향을 살짝 속이는 것

## Add 연산의 구체적인 효과와 과정
월드 공간 노멀 벡터에 float3(0, 0, 1)을 더한다고 가정

1. 방향 왜곡: 원래 노멀 벡터에 (0, 0, 1)을 더하면, 새로운 벡터는 원래 방향보다 더 위쪽을 향하게 됨
- 예: 45도 기울어진 경사면의 노멀 (0.7, 0, 0.7)에 (0, 0, 1)을 더하면 (0.7, 0, 1.7). Z값이 훨씬 커짐
2. 정규화 (Normalize)
- Add 연산 후 벡터의 길이는 1이 아니게 되므로, 방향 벡터로 사용하기 위해서는 반드시 Normalize
- 이 과정을 거치면 최종적으로 '원래 방향보다 더 위쪽을 가리키는' 새로운 방향 벡터가 완성
3. 결과
- 이렇게 왜곡된 노멀의 Z값은 원래 노멀의 Z값보다 더 커지게 됨
- 따라서 Lerp의 Alpha로 사용했을 때, 더 넓은 영역이 '위를 향한 것'으로 간주되어 텍스처가 블렌딩
