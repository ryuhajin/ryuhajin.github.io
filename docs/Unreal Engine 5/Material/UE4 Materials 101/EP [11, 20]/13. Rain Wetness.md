---
layout: default
title: "13. Rain Wetness"
parent: "EP [11 , 20]"
nav_order: 3
---

# EP 13 : Rain Wetness
비에 젖은 표면(Wet Surfaces) 효과를 구현하는 방법

## Wetness Surfaces 특징

### 색상 변화 (다공성 표면의 경우)
- 흙이나 벽돌, 나무처럼 **물을 흡수하는 다공성(porous) 표면은**
- **물에 젖으면 더 어둡고, 채도가 높아진다**

> 이는 빛이 표면의 물 분자와 상호작용하며 난반사가 줄어들고 흡수가 늘어나기 때문

### 표면 속성 변화 (모든 표면)
- 물이 표면의 미세한 틈을 메우면서 **표면이 더 매끄러워 짐**
  - PBR 파라미터에서는 이를 **Roughness(거칠기) 값이 낮아지는 것으로 표현할 수 있음**
- 또한, 물 자체의 반사 특성으로 인해 Specular(정반사) 값이 미세하게 변함
  - 물의 **Specular 값**을 `0.3`으로 설정. 이는 대부분의 **재질 기본값인 0.5보다 약간 낮은 값**

> 이는 물이 정면에서 볼 때 생각보다 반사율이 높지 않다는 물리적 사실에 기반

---

## Desaturation 노드
Desaturation이란, 단어 그대로 채도(Saturation)를 감소시키는 과정

- 입력으로 들어온 원본 색상을 얼마나 바래게 할지를 Fraction 값(0.0 ~ 1.0)으로 결정

```
[팔레트 위에 선명한 빨간색 물감이 있다고 가정]

Fraction = 0: 회색 물감을 전혀 섞지 않는다. 결과는 원래의 빨간색 그대로

Fraction = 0.5: 빨간색 물감과 회색 물감을 1:1로 섞는다. 결과는 탁한 분홍색/회색

Fraction = 1.0: 회색 물감만 사용. 결과는 완전히 회색
```

> Desaturation 노드의 핵심은 선형 보간(Lerp) 이므로 음수를 넣으면 외삽이 일어남

---

# 그래프 예제

## Wetness Base Color
마른 표면의 Base Color 텍스처를 입력받아 젖었을 때의 색상으로 변환

1. Desaturation 노드로 채도 조절
   - Fraction 입력에 음수 값을 넣어 채도를 높임
2. saturate 로 클램핑 [0-1] 한 뒤 0.5 곱하여 밝기 감소
3. Lerp(오리지널 (마른 색상), 젖은 색상 (1~2번 과정으로 만든 결과값)) 로 알파값에 따라 섞어줌
    - 알파 1 : 오리지널 안보임 -> 젖은 상태
    - 알파 0 : 오리지널만 보임 -> 마른 상태

---

## Wetness Roughness, Wetness Specular
1. 값 정의
   - '마른 상태'의 Roughness와 Specular 값을 가져옴 (Specular는 기본값 0.5 사용)
   - '젖은 상태'의 **Roughness(0.07)와 Specular(0.3) 값을 상수로 정의**
2. 결합 및 혼합
   - AppendVector 사용. 마른 상태의 Roughness(R 채널)와 Specular(G 채널)를 하나의 2D 벡터로 합침
   - Lerp 사용. '마른 상태 (A)'와 '젖은 상태 (B)'을 위와 동일한 Alpha(젖은 정도) 값으로 혼합
3. 값 분리
   - ComponentMask 사용.
   - 혼합된 결과 벡터에서 R 채널(새로운 Roughness)
   - G 채널(새로운 Specular)을 각각 분리하여 최종 머티리얼의 해당 슬롯에 연결

---

## MF_Wetness
머티리얼 함수를 통해 모듈화 하기

1. **입력(Inputs)**
    - BaseColor, Roughness, Specular: 원본 머티리얼의 속성 값
    - Wetness Mask: 표면의 어느 부분이 젖을지 결정하는 텍스처 또는 값 (0은 마름, 1은 젖음)
    - Porousness: 표면이 다공성인지 여부 (1이면 색상 변화 적용, 0이면 미적용)
2. **출력(Outputs)**
    - BaseColor, Roughness, Specular: '젖음' 효과가 적용된 새로운 속성 값

> Porousness 는 Wetness Mask와 곱해서 lerp의 알파로 들어감
