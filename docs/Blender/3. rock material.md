---
layout: default
title: "3. rock material"
parent: "Blender"
nav_order: 3
---

# 3. rock material
바위 머티리얼 만들면서 이해 안가는 부분 정리

---

# 노이즈(Noise) 노드 개념 정리

## 노이즈는 “타일 이미지”가 아니라 “좌표 → 연속값 함수”
좌표 `(x, y, z)`를 입력받아 **연속적인 값(보통 0~1)**을 반환하는 함수

- 즉 노이즈는 무한히 펼쳐진 난수장(field)을 **좌표로 샘플링**하는 것에 가깝다

---

### 이미지 텍스처 vs 절차 노이즈
- **Image Texture**
  - Wrap=Repeat면 `UV*5` → **0~1 구간에 이미지가 정확히 5번 타일**
- **Noise Texture(절차 노이즈)**
  - `noise(UV*5)`는 “정확히 5번 반복”이 아니라
  - **노이즈 필드에서 더 넓은 좌표 범위를 샘플링**해서 결과가 **더 촘촘해 보이는 것**
  - 노이즈는 보통 **주기 함수가 아니므로** 동일 패턴이 딱 주기로 반복되지 않음

> 정말로 정확히 반복을 강제하려면 `frac(UV*5)`(= mod 1)을 노이즈에 넣을 수 있다
> - 하지만 경계에서 좌표가 뚝 끊겨 **이음새(seam)**가 생기기 쉽다

---

## Scale = 좌표를 얼마나 빠르게 움직이느냐
### 핵심 로직
- 노이즈는 `v = noise(x, y)` 같은 함수라고 보면 된다
- Scale을 적용하면: `v = noise(x*Scale, y*Scale)`
- Scale이 커질수록 같은 거리에서 좌표가 더 많이 변해
  - **패턴이 더 촘촘해지고(특징 크기 ↓)**
  - **변화 속도(= 공간 주파수)가 올라간다**

```md
Scale ↑ = 더 고주파 (잔디/모래처럼 잔잔)
Scale ↓ = 더 저주파 (큰 얼룩/큰 덩어리)
```

---

## Detail = 옥타브(고주파 레이어) 추가
### 정정
- Detail은 보통 **프랙탈 노이즈에서 옥타브(Octave)를 몇 단계 쌓는지**에 해당한다
- **Detail ↑**:
  - 더 높은 주파수(더 작은 패턴) 레이어를 계속 더함
  - 결과가 더 복잡/자글자글해짐

### 혼동 포인트
detail은 진폭을 추가하는 것인가? NO

- 사람은 고주파 성분이 늘어난 표면을 더 거칠고 가파르게 느낄 수 있다
- 하지만 Detail 자체가 **높이(진폭) 를 직접 올리는 개념은 아님**

```md
진폭(강도)은 보통:
  - 노이즈 출력에 Multiply,
  - Bump/Normal 강도,
  - Map Range/Power/ColorRamp로 분포 재가공

같은 방식으로 따로 조절함
```

---

## (노이즈 파라미터) Roughness는 PBR Roughness가 아니다
Blender Noise Texture의 Roughness는 PBR roughness와 다른 의미다.

- 프랙탈 합성에서 옥타브가 올라갈수록(고주파로 갈수록) **레이어 진폭이 얼마나 유지/감쇠되는지를 조절하는 값**에 가깝다

```md
Roughness ↑: 고주파 레이어 영향이 커져 더 거칠게
Roughness ↓: 고주파 레이어가 빨리 약해져 부드럽게
```

---

## 타일 반복 vs 주파수 증가
- **타일 반복**: 같은 패턴이 주기적으로 재등장 (이미지 텍스처 + Repeat Wrap)
- **주파수 증가**: 변화가 더 촘촘해짐(패턴이 더 잔잔) (절차 노이즈에서 Scale ↑)

---

# rock procedural material
## color ramp 로 노이즈 마스크 선명하게 만들기
color ramp는 보간 함수. 입력값 x를 출력값 y로 바꾸는 전달 함수

```c++
y = clamp((x - b) / (w - b), 0, 1);
```

- x ≤ b 인 구간은 전부 0(검정) 으로 눌림
- x ≥ w 인 구간은 전부 1(흰색) 으로 포화
- b ~ w 사이만 0 → 1로 변화 (그라데이션)

### 검정과 흰색을 중간쯤으로 둘 다 당기면?
1. 검정 = 0.45
2. 흰색 = 0.55

- 노이즈 값이 0.45보다 작은 영역은 전부 검정
- 0.55보다 큰 영역은 전부 흰색
- 딱 0.45 ~ 0.55 근처의 좁은 띠만 부드럽게 변함

## rock 재질에서 목적
**노이즈는 보통 중간값이 많아**서 그대로 쓰면 **부드러운 얼룩에 가깝다**

따라서 color ramp로 중간값을 경게로 사용하면

- 노이즈 전체 중 중간값 근처만 경계로 남음
- 나머지는 검정/흰색으로 포화시켜 마스크가 강하게 만들어짐

```md
[color ramp 사용]

마스크를 더 얇게/선명하게: 검정·흰색을 더 가까이(간격 좁힘)

마스크를 더 넓게/부드럽게: 검정·흰색을 멀리(간격 넓힘)

흰색(선택 영역)을 늘리고 싶다: 흰색 핸들을 왼쪽으로

검정(배경)을 늘리고 싶다: 검정 핸들을 오른쪽으로
```

---

# Geometry node
현재 셰이딩 중인 **지점(shading point)에 대한 기하 정보**를 꺼내는 노드

- **한 픽셀 (정확히는 샘플링 된 점)에서 표면의 위치/방향/시야벡터/뒷면 여부 같은 값**을 내보냄
- 이 노드의 벡터 출력들은 **월드 좌표계(World Space) 기준**

## 출력 정리

| 출력  | 타입   | 의미  | 흔한 용도/메모 |
| -----| ------ | ------ | ------------ |
| Position    | Vector | 현재 셰이딩 지점의 월드 위치  | 월드 기준 그라데이션(높이에 따른 색 변화), 월드 정렬 마스크 (예: 위쪽에만 마스크) |
| Normal      | Vector | 셰이딩 노멀(보통 스무딩이 반영된 노멀) | 경사 마스크(위/옆면 분리), 트라이라너 계열, 라이트 방향 기반 효과(먼지/눈) |
| Tangent     | Vector | 표면의 탄젠트 방향(주로 UV에 기반)  | Anisotropic(결 방향) 효과, 브러시 결/스크래치 방향성(단, UV/탄젠트가 의미 있어야 함) |
| True Normal | Vector | 진짜(평면) 노멀. 폴리곤의 플랫 노멀(스무딩 영향 적음)       | 로우폴리 면 단위 마스크, 페이스가 꺾이는 곳 강조(면 기반 효과)  |
| Incoming    | Vector | 셰이딩 지점에서 카메라/레이 방향으로 향하는 벡터  | Fresnel/림라이트/뷰 의존 효과 커스터마이즈 |
| Parametric  | Vector | 표면 내부에서의 파라메트릭(삼각형 내부 좌표/바리센트릭 계열) 값 | 와이어프레임/삼각형 가장자리 기반 특수 마스크, 폴리곤 내부 좌표 활용  |
| Backfacing  | Value  | 현재 픽셀이 뒷면(backface)이면 1, 앞면이면 0에 가까움 | 얇은 메쉬(잎/종이) 양면 처리, 가장자리 얇은 셸 마스크  |
| Pointiness  | Value  | 메시의 뾰족함/굴곡(곡률)을 근사한 값(엣지/캐비티 마스크용)     | 엣지 웨어, 캐비티(홈) 마스크. Cycles 전용인 경우가 많음 |


---

## Pointiness로 엣지(면-면 경계)가 잘 안 잡히는 이유
1. **렌더 엔진/뷰포트 문제 (가장 흔함)**
    - Pointiness는 Eevee에서 동작하지 않거나 제한적
    - Cycles에서 쓰는 방식으로 안내되는 경우가 많다
    - Eevee (또는 Material Preview 상태)에서 적용이 안되는 것 처럼 보일 수 있다
    - **해결 방법** : Render Engine을 Cycles로 바꾸고, 뷰포트를 Rendered로 확인해보기
2. **기본 메시 (로우폴리)라서 곡률 정보가 부족함**
    - Pointiness는 엣지 마스크를 기하 기반(각도/곡률) 성질을 이용해 만든다
    - 따라서 결과는 버텍스 밀도에 크게 의존됨
    - 로우폴리에서 큰 면이 길게 이어지면, 엣지 주변 샘플링이 거칠어져 엣지 라인이 깨끗하게 안 나옴
    - **해결 방법** : Subdivision Surface(간단 분할)나 Bevel로 기하 늘리기
3. **엣지가 날카로운데 실제로는 ‘곡면’이 없음**
    - 바위 마스크는 보통 각진 90도 모서리가 아니라, 미세하게라도 **라운딩된 엣지(곡률)**에서 자연스럽게 나옴
    - 기본 큐브처럼 완전 날카로운 곡률 기반 마스크는 기대한 만큼 예쁘게 안 나올 수 있음
    - **해결 방법** : 2번과 마찬가지로 bevel과 같은 엣지 만들기
4. **ColorRamp 세팅 문제**
    - Pointiness가 보통 완만한 회색 분포로 나오기 쉬움 (로우폴리일수록 더 민감)
    - **해결 방법** : color ramp로 대비 확실히 주기

---

# voronoi texture node
Voronoi(= Worley) 노이즈는 공간(2D/3D/4D)에 **무작위 특징점(feature point)들을 뿌린 뒤, 각 위치에서 가장 가까운 특징점은 무엇인가?를 계산한다**

- 공간의 **모든 점은 가장 가까운 특징점 하나에 소속**되고, 그 결과 **공간이 셀(폴리곤/폴리헤드론)로 분할**
- 따라서 **패턴이 세포/돌조각/갈라짐 같은 cellular 구조**를 자연스럽게 가진다

---

## dimensions options
## Dimensions (1D/2D/3D/4D)
Voronoi를 몇 차원 공간에서 계산할지 결정

- **1D**: W 스칼라만 사용
- **2D**: (x, y)
- **3D**: (x, y, z)
- **4D**: (x, y, z, w)

```md
3D는 오브젝트 표면에서 방향성 없는 자연스러운 볼륨 패턴(바위/얼룩)에 유리하다

2D(UV)는 베이크/타일링 관리가 쉬운 대신 UV 왜곡의 영향을 받음
```

---

## Feature (F1 / F2 / Smooth F1 / Distance to Edge / N-Sphere Radius)
Voronoi는 내부적으로 **여러 개의 특징점(feature point, seed)**을 두고 **현재 좌표에서 그 점들까지의 거리를 계산한 다음 가까운 순서로 정리함**

- Feature 옵션은 그 거리들(F1, F2 …)이나
- 그로부터 만든 파생값 중 무엇을 내보낼지를 고르는 것


- **F1**: 가장 가까운 특징점까지의 거리 (최소 거리) + 그 점의 위치/색 정보
- **F2**: 두 번째로 가까운 특징점까지의 거리 + 그 점의 위치/색
- **Smooth F1**: F1을 이웃 셀들과 가중합으로 부드럽게 만든 버전 (경계가 더 부드러움)
- **Distance to Edge**: 현재 점이 속한 voronoi 셀의 경계(edge)까지의 거리
- **N-Sphere Radius**: 각 셀 안에 들어가는 n-sphere의 반지름 (셀 두께/여유 지표)
    - 가장 가까운 특징점과 그 점에 가장 가까운 다른 특징점 사이 거리의 절반

---

## Distance Metric (Euclidean / Manhattan / Chebychev / Minkowski)
**거리 계산 방식을 바꿔** 셀의 기하학적 성격이 달라짐

- Voronoi의 Distance Metric은 바로 이 **거리 함수를 선택하는 옵션**

- **Euclidean (L2)**: 가장 일반적, 자연스러운 원형/유기적 거리
- **Manhattan (L1)**: 다이아몬드/격자를 따라 가는 거리 (도시 블록 거리)
- **Chebychev (L∞)**: 사각/체커 이동 같은 거리 (가장 큰 축 차이)
- **Minkowski (Lp)**: 지수(Exponent)로 위 성향을 연속적으로 조절

---

## Voronoi에서 거리는 무슨 의미인가? (로직)
Voronoi/Worley 노이즈의 핵심 알고리즘 간단히 

1. 공간에 seed(특징점)들을 뿌린다
2. 셰이딩 지점 x에서 각 seed 까지의 거리 d(x, seed) 를 선택된 Distance Metric으로 계산한다
3. 그 거리들을 정렬해서 `F1≤F2≤…` 를 만든다
4. Feature 설정에 따라 F1, F2, 경계까지 거리, 반지름 등을 출력한다
    - 포인트: 내가 어떤 셀에 속하는가?는 **가장 가까운 seed가 누구냐(F1 최소)**로 결정

```md
셀의 경계는 두 seed까지의 거리가 같아지는 점들의 집합이다

따라서 거리 공식이 바뀌면,
- 가까움의 기준이 바뀌고
- 등거리 곡선(iso-distance)의 모양이 바뀌며

결과적으로 셀 모양/경계 모양/균열 모양이 달라진다
```

---

## 바위(rock)에서 Voronoi를 쓰는 대표 패턴 3개
1. **자갈/돌 알갱이 덩어리**
    - Feature=F1, Metric=Euclidean
    - Distance → ColorRamp(임계) → Bump/Height
2. **균열/크랙**
    - Feature=Distance to Edge
    - Distance → Invert(또는 램프) → 얇은 선 마스크 → Bump/Albedo/Roughness에 주입
3. **셀별 랜덤 변주(자연스러움)**
    - Color 출력(셀 ID 느낌)을 이용해
    - 셀별 색 변화, Roughness 랜덤, 마스크 랜덤을 만들기

---

